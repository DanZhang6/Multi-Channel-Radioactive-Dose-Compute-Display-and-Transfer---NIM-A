C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE 8253COUNT
OBJECT MODULE PLACED IN .\Objects\8253count.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE 8253count.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Li
                    -stings\8253count.lst) TABS(2) OBJECT(.\Objects\8253count.obj)

line level    source

   1          /********************************************************************************************
   2          *ÃèÊö£º
   3          *   8253¼ÆÊýÉèÖÃ
   4          *¹¦ÄÜ£º
   5          *   1.´Ó8253ÖÐ¶ÁÈ¡¼ÆÊý£¬Ã¿¸ö8253ÖÐº¬ÓÐ3¸ö¼ÆÊýÆ÷£¬Îå¸ö8253¼Æ15¸öÌ½Í·µÄ¼ÆÊý£¬
   6          *     Ç°Æß¸öÌ½Í·ÊÇË«Ì½Í·£¨µÍ¼ÆÊýÌ½Í·ºÍ¸ß¼ÆÊýÌ½Í·£©£¬µÚ°Ë¸öÌ½Í·ÊÇµ¥Ì½Í·£¨¸ß¼ÆÊýÌ½Í·£©£¬
   7          *     ¸ù¾Ý¼ÆÊýÂÊÑ¡ÔñÄÄ¸öÌ½Í·¹¤×÷£»
   8          *   2.T0¶¨Ê±ÖÐ¶Ï
   9          *     T0¹¤×÷ÔÚ16Î»×Ô¶¯ÖØÔØÄ£Ê½£¬ÏòÉÏ¼ÆÊý£¬Ã¿Ñ­»·Ò»´Î£¬×Ü¶¨Ê±5Ms,¼ÆÊý³õÖµDC00£¬¾§Õñ22.1184M£»
  10          *   3.¶¨Ê±µ½£¬¶ÁÈ¡¼ÆÊý£¬¸ù¾ÝÉè¶¨µÄ²ÎÊý£¬ÏÔÊ¾¸÷Ì½Í·µÄ¼ÆÊýÂÊ£»
  11          *   4.¸ù¾Ý¼ÆÊýÂÊµÄ²»Í¬£¬Ñ¡Ôñ²»Í¬µÄµ¥Î»£¨uGy/s,mGy/s,Gy/s£©;
  12          
  13          ***********************************************************************************************/
  14          #include "STC15F2K60S2.h"
  15          #include "intrins.h"
  16          #include "config.h"
  17          #include "absacc.h"
  18          #include "stdio.h"
  19          #include "math.h"
  20          
  21          #define C82531C XBYTE[0x8300]                                       //8253µÄÃüÁî¶Ë¿Ú£¨µØÖ·£©£¬CS4=1,CS3=1,
             -CS2=1,CS1=1,CS0=0,A1A0=11£»
  22          #define C825310D XBYTE[0x8000]                                      //¼ÆÊýÆ÷0CS4=1,CS3=1,CS2=1,CS1=1,CS0=0
             -,A1A0=00£»
  23          #define C825311D XBYTE[0x8100]                                      //¼ÆÊýÆ÷1CS4=1,CS3=1,CS2=1,CS1=1,CS0=0
             -,A1A0=01;
  24          #define C825312D XBYTE[0x8200]                                      //¼ÆÊýÆ÷2CS4=1,CS3=1,CS2=1,CS1=1,CS0=0
             -,A1A0=10;
  25          
  26          #define C82532C XBYTE[0x8b00]                                       // XBYTEµÄ×÷ÓÃÊÇ½«Íâ²¿I/O¶Ë¿ÚÖÃÎªÖÐÀ¨º
             -ÅÄÚ²¿µÄ16Î»¶þ½øÖÆ£¬¼´ÎªÉèÖÃ
  27          #define C825320D XBYTE[0x8800]                                      //Ê¹ÄÜ¶Ë£¬ XBYTEµÄ×÷ÓÃ»¹ÓÐÉèÖÃÊ¹ÄÜ¶Ëºó
             -£¬×Ô¶¯ÉèÖÃwr,rd.
  28          #define C825321D XBYTE[0x8900]
  29          #define C825322D XBYTE[0x8a00]
  30          
  31          #define C82533C XBYTE[0x9300]
  32          #define C825330D XBYTE[0x9000]
  33          #define C825331D XBYTE[0x9100]
  34          #define C825332D XBYTE[0x9200]
  35          
  36          #define C82534C XBYTE[0x9b00]
  37          #define C825340D XBYTE[0x9800]
  38          #define C825341D XBYTE[0x9900]
  39          #define C825342D XBYTE[0x9a00]
  40          
  41          #define C82535C XBYTE[0xa300]
  42          #define C825350D XBYTE[0xa000]
  43          #define C825351D XBYTE[0xa100]
  44          #define C825352D XBYTE[0xa200]
  45          
  46          uchar buf[32];                                                                    //AB1*´Ó8253ÖÐ¶Áµ½µÄ¼ÆÊý
             -Æ÷Êý¾Ý£¬15¸ö¼ÆÊýÆ÷£¬µÍ°ËÎ»¸ß°ËÎ»£¬´Ó3-32£¬1ÎªÌ½Í·¸öÊý£¬2Îª²âÁ¿Ê±¼ä
  47          uchar Channel_Detector[8][2];                                                     //AC1+Í¨µÀÌ½Í·Ñ¡Ôñ±êÖ¾£¬
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 2   

             -1:µçÀëÊÒ0:¼ÆÊý¹Ü
  48          uchar DataGe[75];                                                                 //Ì½²âÆ÷±ê¶¨²ÎÊýµÄ¸öÎ»£¬
             -³õÊ¼Ê±¸öÊ®°ÙÇ§¾ùÎª0
  49          uchar DataTenth[75];                                                              //Ì½²âÆ÷±ê¶¨²ÎÊýµÄÊ®·ÖÎ»
  50          uchar DataCent[75];                                                               //Ì½²âÆ÷±ê¶¨²ÎÊýµÄ°Ù·ÖÎ»
  51          uchar DataThouth[75];                                                             //Ì½²âÆ÷±ê¶¨²ÎÊýµÄÇ§·ÖÎ»
  52          uchar send_buf[65];                                                               //NIM_AÏòNIM_B·¢ËÍÊý¾ÝµÄ
             -Êý×é
  53          uchar Incinput;                                                                   //Ì½Í·¸öÊý±êÖ¾£¬Ä¬ÈÏÏÔÊ¾
             -Ì½Í·¸öÊýÎª8¸ö
  54          float idata Para[10];                                                             //Éè¶¨ºÃµÄ²ÎÊýÊý×é
  55          float DoseRata[8];                                                                //Ã¿×éÌ½Í·²âµÃµÄ¼ÁÁ¿ÂÊ
  56          uchar Channel_Display[8];                             //ÓÃÓÚÏÔÊ¾µÄÍ¨µÀÁ¿³Ì
  57          float jishuguan_DoseRata;
  58          float dianlishi_DoseRata;
  59          uchar Calculated[8];                                                              //ÊÇ·ñ¼ÆËã¹ý±êÖ¾
  60          uchar Flag_dw;                                                                    //µ¥Î»±êÖ¾
  61          uchar Max_Time;                                                                   //AA1+ËùÓÐÍ¨µÀ×î³¤µÄ¼ÆÊý
             -Ê±¼ä
  62          uint Tdata;                                                                 //Ì½Í·¼ÆÊýÂÊ
  63          uint Real_Count[8];
  64          ulong Count[8][3];                                //Ò»Ãë¼ÆÊýÀúÊ·
  65          uint idata jishuguan_data;                                                        //±ê¶¨Ê±µÄ¼ÆÊý¹Ü¼ÆÊýÖµÏà
             -µ±ÓÚTdata
  66          uint idata dianlishi_data;                                                        //±ê¶¨Ê±µÄµçÀëÊÒ¼ÆÊýÖµÏà
             -µ±ÓÚTdata
  67          uchar idata Var_Signal1;                                                          //Ì½Í·¿ØÖÆÐÅºÅ1£¬½Ó¼ÆÊý¹
             -Ü£¬Ä¬ÈÏff¾ù½Ó¼ÆÊý¹Ü
  68          uchar idata Var_Signal2;                                                          //Ì½Í·¿ØÖÆÐÅºÅ2£¬½ÓµçÀëÊ
             -Ò£¬Ä¬ÈÏ00£»
  69          uchar idata Var_Signal3;                                                          //Ì½Í·¿ØÖÆÐÅºÅ3£¬½ÓµçÀëÊ
             -Ò£¬Ä¬ÈÏ00£»
  70          uchar idata Var_Led;                                                              //LED±¨¾¯Ö¸Ê¾µÆ,Îª1Ê±Ãð,
             -³õÖµ0xff,
  71          uchar biaoding_input;
  72          bit Flag_Warn_Count;                                                              //Ä¬ÈÏ0£»
  73          uchar Flag_need_Flash[8];                                                         //LEDÉÁË¸±êÖ¾
  74          uchar State_Flash[8];
  75          uchar count_change_flag[8];                                                       //¼ÆÊý¸Ä±ä±êÖ¾£¿
  76          float code a0=0.0625;
  77          float code a1=0.0625;
  78          float code a2=0.125;
  79          float code a3=0.25;
  80          float code a4=0.5;
  81          uchar code Svar1[8]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};                   //ÐÅºÅÊý×é
  82          uchar code Svar0[8]={0xFE,0xFD,0xFB,0xF7,0xEF,0xDF,0xBF,0x7F};
  83          extern uchar jishucount;
  84          extern uchar  Average_Times[8];                         //AJ1+»¬¶¯Æ½¾ù´ÎÊý
  85          extern uchar Display_Flag[8];
  86          
  87          extern bit Speak_Alarm();
  88          
  89          
  90          
  91          void shortdelay(uint i);
  92          void Alarm();
  93          void Led_Disp(uchar Num,uchar Flag,uchar State);
  94          void Updata_Flash(uchar j);
  95          extern bitSpeak_Alarm();
  96          /*************************************
  97          *8253¼ÆÊýÖµ
  98          **************************************/
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 3   

  99          void GetAndDisdata()                                                              //¼ÆÊýÍê³ÉºóµÚÒ»¸öÔËÐÐµÄ
             -³ÌÐò
 100          {
 101   1        uchar j;
 102   1        uchar th=0;
 103   1        uchar tl=0;                                                                        //bufÊý×é³õÊ¼»¯
 104   1        for(j=0;j<10;j++)
 105   1        {
 106   2          Para[j]=0;
 107   2        }
 108   1        for(j=0;j<8;j++)
 109   1        {
 110   2        Calculated[j]=0;
 111   2        }
 112   1        /*===========Ëø´æ8253µÄ¼ÆÊýÖµ==========*/
 113   1        C82531C=0x84;                                                                   //Ëø´æµÚÒ»Æ¬8253¼ÆÊýÆ÷2µ
             -Ä¼ÆÊýÖµ
 114   1        tl=C825312D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 115   1        buf[2]=0xff-tl;
 116   1        th=C825312D;
 117   1        buf[3]=0xff-th;
 118   1      
 119   1        C82531C=0x44;                                                                   //Ëø´æµÚÒ»Æ¬8253¼ÆÊýÆ÷1µ
             -Ä¼ÆÊýÖµ
 120   1        tl=C825311D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 121   1        buf[4]=0xff-tl;
 122   1        th=C825311D;
 123   1        buf[5]=0xff-th;
 124   1      
 125   1        C82531C=0x04;                                                                   //Ëø´æµÚÒ»Æ¬8253¼ÆÊýÆ÷0µ
             -Ä¼ÆÊýÖµ
 126   1        tl=C825310D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 127   1        buf[6]=0xff-tl;
 128   1        th=C825310D;
 129   1        buf[7]=0xff-th;
 130   1      
 131   1        C82532C=0x84;                                                                   //Ëø´æµÚ¶þÆ¬8253¼ÆÊýÆ÷2µ
             -Ä¼ÆÊýÖµ
 132   1        tl=C825322D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 133   1        buf[8]=0xff-tl;
 134   1        th=C825322D;
 135   1        buf[9]=0xff-th;
 136   1      
 137   1        C82532C=0x44;                                                                   //Ëø´æµÚ¶þÆ¬8253¼ÆÊýÆ÷1µ
             -Ä¼ÆÊýÖµ
 138   1        tl=C825321D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 139   1        buf[10]=0xff-tl;
 140   1        th=C825321D;
 141   1        buf[11]=0xff-th;
 142   1      
 143   1        C82532C=0x04;                                                                   //Ëø´æµÚ¶þÆ¬8253¼ÆÊýÆ÷0µ
             -Ä¼ÆÊýÖµ
 144   1        tl=C825320D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 145   1        buf[12]=0xff-tl;
 146   1        th=C825320D;
 147   1        buf[13]=0xff-th;
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 4   

 148   1      
 149   1        C82533C=0x84;                                                                   //Ëø´æµÚÈýÆ¬8253¼ÆÊýÆ÷2µ
             -Ä¼ÆÊýÖµ
 150   1        tl=C825332D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 151   1        buf[14]=0xff-tl;
 152   1        th=C825332D;
 153   1        buf[15]=0xff-th;
 154   1      
 155   1        C82533C=0x44;                                                                   //Ëø´æµÚÈýÆ¬8253¼ÆÊýÆ÷1µ
             -Ä¼ÆÊýÖµ
 156   1        tl=C825331D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 157   1        buf[16]=0xff-tl;
 158   1        th=C825331D;
 159   1        buf[17]=0xff-th;
 160   1      
 161   1        C82533C=0x04;                                                                   //Ëø´æµÚÈýÆ¬8253¼ÆÊýÆ÷0µ
             -Ä¼ÆÊýÖµ
 162   1        tl=C825330D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 163   1        buf[18]=0xff-tl;
 164   1        th=C825330D;
 165   1        buf[19]=0xff-th;
 166   1      
 167   1        C82534C=0x84;                                                                   //Ëø´æµÚËÄÆ¬8253¼ÆÊýÆ÷2µ
             -Ä¼ÆÊýÖµ
 168   1        tl=C825342D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 169   1        buf[20]=0xff-tl;
 170   1        th=C825342D;
 171   1        buf[21]=0xff-th;
 172   1      
 173   1        C82534C=0x44;                                                                   //Ëø´æµÚËÄÆ¬8253¼ÆÊýÆ÷1µ
             -Ä¼ÆÊýÖµ
 174   1        tl=C825341D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 175   1        buf[22]=0xff-tl;
 176   1        th=C825341D;
 177   1        buf[23]=0xff-th;
 178   1      
 179   1        C82534C=0x04;                                                                   //Ëø´æµÚËÄÆ¬8253¼ÆÊýÆ÷0µ
             -Ä¼ÆÊýÖµ
 180   1        tl=C825340D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 181   1        buf[24]=0xff-tl;
 182   1        th=C825340D;
 183   1        buf[25]=0xff-th;
 184   1      
 185   1        C82535C=0x84;                                                                   //Ëø´æµÚÎåÆ¬8253¼ÆÊýÆ÷2µ
             -Ä¼ÆÊýÖµ
 186   1        tl=C825352D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 187   1        buf[26]=0xff-tl;
 188   1        th=C825352D;
 189   1        buf[27]=0xff-th;
 190   1      
 191   1        C82535C=0x44;                                                                   //Ëø´æµÚÎåÆ¬8253¼ÆÊýÆ÷1µ
             -Ä¼ÆÊýÖµ
 192   1        tl=C825351D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 193   1        buf[28]=0xff-tl;
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 5   

 194   1        th=C825351D;
 195   1        buf[29]=0xff-th;
 196   1      
 197   1        C82535C=0x04;                                                                   //Ëø´æµÚÎåÆ¬8253¼ÆÊýÆ÷0µ
             -Ä¼ÆÊýÖµ
 198   1        tl=C825350D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 199   1        buf[30]=0xff-tl;
 200   1        th=C825350D;
 201   1        buf[31]=0xff-th;
 202   1      
 203   1        buf[0]=Incinput;                                                                //Ì½Í·¸öÊý
 204   1        buf[1]=Max_Time;                                                              //²âÁ¿Ê±¼ä£¨Ë¢ÐÂÊ±¼ä±êÖ¾£©
 205   1      }
 206          /*******************************************
 207          *8253¼ÆÊýÆ÷³õÊ¼»¯
 208          ********************************************/
 209          void Init_8253()
 210          {
 211   1        uchar i;//AB1+
 212   1        //=======×°Èë³õÖµÔÙ¿ªÊ¼¼ÆÊý=======//
 213   1        C82531C=0xb4;                                                                   //10110100
 214   1        C825312D=0xff;                                                                  //10£ºÍ¨µÀ2,11£ºÏÈµÍ×Ö½Ú
             -ºó¸ß×Ö½Ú£¬010£º°´·½Ê½2¹¤×÷£¬0£º¶þ½øÖÆ¼ÆÊý¡£Ð´³õÖµ0xffºó¿ªÊ¼¼ÆÊý
 215   1        C825312D=0xff;
 216   1      
 217   1        C82531C=0x74;                                                                   //01110100
 218   1        C825311D=0xff;                                                                  //Í¬ÉÏ
 219   1        C825311D=0xff;
 220   1      
 221   1        C82531C=0x34;                                                                   //00110100
 222   1        C825310D=0xff;                                                                  //Ð´³õÖµÏÈµÍ×Ö½Úºó¸ß×Ö½Ú
             -82531Ð´³õÖµºó¾Í¿ªÊ¼¼ÆÊý
 223   1        C825310D=0xff;                                                                  //¶þÈýÐÐÓÃÀ´×°Èë³õÖµ
 224   1      
 225   1        C82532C=0xb4;                                                                   //10110100
 226   1        C825322D=0xff;
 227   1        C825322D=0xff;
 228   1      
 229   1        C82532C=0x74;                                                                   //01110100
 230   1        C825321D=0xff;
 231   1        C825321D=0xff;
 232   1      
 233   1        C82532C=0x34;                                                                   //00110100
 234   1        C825320D=0xff;
 235   1        C825320D=0xff;
 236   1      
 237   1        C82533C=0xb4;                                                                   //10110100
 238   1        C825332D=0xff;
 239   1        C825332D=0xff;
 240   1      
 241   1        C82533C=0x74;                                                                   //01110100
 242   1        C825331D=0xff;
 243   1        C825331D=0xff;
 244   1      
 245   1        C82533C=0x34;                                                                   //00110100
 246   1        C825330D=0xff;
 247   1        C825330D=0xff;
 248   1      
 249   1        C82534C=0xb4;                                                                   //10110100
 250   1        C825342D=0xff;
 251   1        C825342D=0xff;
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 6   

 252   1      
 253   1        C82534C=0x74;                                                                   //01110100
 254   1        C825341D=0xff;
 255   1        C825341D=0xff;
 256   1      
 257   1        C82534C=0x34;                                                                   //00110100
 258   1        C825340D=0xff;
 259   1        C825340D=0xff;
 260   1      
 261   1        C82535C=0xb4;                                                                   //10110100
 262   1        C825352D=0xff;
 263   1        C825352D=0xff;
 264   1      
 265   1        C82535C=0x74;                                                                   //01110100
 266   1        C825351D=0xff;
 267   1        C825351D=0xff;
 268   1      
 269   1        C82535C=0x34;                                                                   //00110100
 270   1        C825350D=0xff;
 271   1        C825350D=0xff;
 272   1        for(i=0;i<67;i++)
 273   1        {
 274   2          DCS_Send[i]=0;
 275   2        }
 276   1        for(i=0;i<=7;i++)
 277   1        {
 278   2          DoseRata[i] = 0;            //Ã¿×éÌ½Í·²âµÃµÄ¼ÁÁ¿ÂÊ
 279   2        }
 280   1        Var_Led=0xff;                                                                   //ledÖ¸Ê¾
 281   1        Led573=Var_Led;
 282   1        EX0=0;                                                                          //¹ØÍâ²¿ÖÐ¶Ï0
 283   1        /*¶¨Ê±¼ÆÊýÆ÷µÄ³õÊ¼»¯*/                                                                         //AJ1-,ÒÆ
             -¶¯ÖÁ¶¨Ê±ÖÐ¶ÏÀï¿ªGate,8253¿ªÆô¼ÆÊý
 284   1        Flag8253Cnting=1;
 285   1        NumT0=0;
 286   1      }
 287          /************************************
 288          *ÏÔÊ¾¼ÆÊý
 289          ************************************/
 290          void ShowData()
 291          {
 292   1        uchar i,m,j,k;                                                                    //AE1-:Var1ÓÃÀ´ÅÐ¶ÏÊ¹Ó
             -ÃµÄÌ½²âÆ÷µÄ¾Ö²¿±äÁ¿£¬Ïàµ±ÓÚChannel_Detector,²»ÔÙÐèÒª
 293   1        ulong count_temp,jishuguan_count_temp,dianlishi_count_temp;
 294   1        float idata temp,jtemp,yudecide,jishuguan_rata,jishuguan_jtemp,dianlishi_jtemp;
 295   1        double yu,yudata,mtemp;
 296   1        uchar Tbcd[12];                                                                 //²âµÃµÄÊý¾ÝµÄbcdÂëÊý×é
 297   1        Lcd_Clear();
 298   1        /**³ÌÐòËµÃ÷:
 299   1        **1,Îª±£Ö¤¼´Ê¹¶à¸öÍ¨µÀ²»ÔÚÍ¬Ò»Á¿³Ì£¬¸ßÁ¿³ÌµÄÍ¨µÀÒ²ÄÜÓÐÆäÏìÓ¦¸ü¿ìµÄ¸üÐÂËÙ¶È£¬³ÌÐòÒ»Ãë¼ÆÊýÒ»´Î£¬10Ãë¼ÆÊýÎª
             -Ê®´ÎÒ»Ãë¼ÆÊýµÄÏà¼Ó
 300   1        **  £¬¼ÁÁ¿ÂÊÏÔÊ¾Ò»ÃëË¢ÐÂÒ»´Î¡£
 301   1        **2,³ÌÐòÖÐ¼ÆÊýÂÊ¼ÆËã¡¢Á¿³Ì»»µ²¡¢¼ÁÁ¿¼ÆËãÏÔÊ¾¸÷²¿·Ö·Ö¿ªÖ´ÐÐ
 302   1        */
 303   1        for(i=0;i<=7;i++)                                                               //8¸öÌ½Í·Öð¸ö¼ì²â
 304   1        {
 305   2            /**
 306   2             * 1.±éÀúÃ¿Ò»¸öÌ½Í·£¨0~7£©£»
 307   2             * 2.ÏÈ´Óbuf£¨´Ó8253¼ÆÊýÆ÷ÖÐÈ¡»ØµÄ¼ÆÊý£©ÖÐ¼ÆËã¼ÆÊý£¬¸ß8Î»*256+µÍ8Î»£¬¼ÇÂ¼Àú´Î¼ÆÊýÖµ£¬Ã¿3Ãë¼ÆÊýÒ»´Î·À
             -Ö¹Òç³ö£»
 308   2             * 3.¸ù¾ÝÃ¿´ÎµÄ¼ÆÊý£¨3S¼ÆÊýÊ±³¤£©ÒÔ¼°µ±Ç°Á¿³ÌºÍÔ¤ÏÈÈ·¶¨µÄ»»µ²ÆµÂÊ£¬ÅÐ¶Ï»»µ²ºÍÖ´ÐÐ²¢¼ÇÂ¼Àú´ÎÁ¿³ÌµµÎ»Ð
             -ÅÏ¢£»
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 7   

 309   2             * 4.ÐèÒª¸ù¾ÝÀúÊ·µÄµµÎ»ÐÅÏ¢½øÐÐÅÐ¶Ï£¬»»µ²ºóµÄ²Ù×÷Óë²»»»µ²µÄ²Ù×÷²»Í¬£¬¹Ê·Ö¿ªÖ´ÐÐ£»
 310   2             * 5.
 311   2             **/
 312   2          if(Channel_Detector[i][0]==Channel_Detector[i][1])//µ±Ç°Ò»´ÎÁ¿³ÌºÍ´Ë´ÎÁ¿³ÌÒ»ÑùÊ±
 313   2          {
 314   3            if((Channel_Detector[i][1]==4)&&(Calculated[i]==0))//DL3Á¿³Ì£¬¶¨Ê±¼ÆÊý3Ãë£¬Ö±½ÓÓÃÀ´¼ÆËã
 315   3            {
 316   4              Real_Count[i]=0;//´ËÁ¿³ÌÃ¿´Î¶¼ÒªÇåÁã
 317   4              Count[i][0]=Count[i][1];//ÀúÊ·¼ÆÊý¸üÐÂ
 318   4              Count[i][1]=Count[i][2];
 319   4              if(i<7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 320   4              {
 321   5                Count[i][2]=buf[4*i+5]*256+buf[4*i+4];      //¼ÓÒ»ÊÇÒòÎªÔÚ¼ÆÊýÖÜÆÚÄÚ»áÓÉÓ²¼þ¸øÒ»¸öÂö³å
 322   5                Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]);
 323   5              }
 324   4              else if(i==7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 325   4              {
 326   5                Count[i][2]=buf[31]*256+buf[30];
 327   5                Real_Count[i]=(uint)(buf[31]*256+buf[30]);
 328   5              }
 329   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 330   4              if((Count[i][1]<(37*Refresh_Time))&&(Count[i][2]<(37*Refresh_Time))&&(i<7))//Á¿³ÌÇÐ»»Ç°7¸öÌ½Í·ÅÐ¶¨Ìõ¼þ
 331   4              {
 332   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 333   5                Channel_Detector[i][1]=3;
 334   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸ß
             -Ñ¹¹Ø
 335   5                      Var_Signal2=Var_Signal2|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 336   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 337   5              }
 338   4              if((Count[i][1]<(28*Refresh_Time))&&(Count[i][2]<(28*Refresh_Time))&&(i==7))//Á¿³ÌÇÐ»»µÚ°Ë¸öÌ½Í·ÅÐ¶¨Ìõ
             -¼þ
 339   4              {
 340   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 341   5                Channel_Detector[i][1]=3;
 342   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸ß
             -Ñ¹¹Ø
 343   5                      Var_Signal2=Var_Signal2|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 344   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 345   5              }
 346   4              Real_Count_Display[i]=(float)((Real_Count[i]*5)/Refresh_Time);
 347   4              Channel_Display[i]=4;
 348   4              Display_Flag[i]=1;//Ö±½ÓÔÊÐíÏÔÊ¾
 349   4            }
 350   3            if((Channel_Detector[i][1]==3)&&(Calculated[i]==0))//DL2Á¿³Ì£¬Á½´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó
 351   3            {
 352   4              Count[i][0]=Count[i][1];
 353   4              Count[i][1]=Count[i][2];
 354   4              if(i<7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 355   4              {
 356   5                Count[i][2]=buf[4*i+5]*256+buf[4*i+4];
 357   5                Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]);
 358   5              }
 359   4              else if(i==7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 360   4              {
 361   5                Count[i][2]=buf[31]*256+buf[30];
 362   5                Real_Count[i]=(uint)(buf[31]*256+buf[30]);
 363   5              }
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 8   

 364   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 365   4              if((Count[i][1]>(5719*Refresh_Time))&&(Count[i][2]>(5719*Refresh_Time))&&(i<7))//Á¿³ÌÇÐ»»
 366   4              {
 367   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 368   5                Channel_Detector[i][1]=4;
 369   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸ß
             -Ñ¹¹Ø
 370   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 371   5                      Var_Signal3=Var_Signal3|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 372   5              }
 373   4              if((Count[i][1]>(7447*Refresh_Time))&&(Count[i][2]>(7447*Refresh_Time))&&(i==7))//Á¿³ÌÇÐ»»
 374   4              {
 375   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 376   5                Channel_Detector[i][1]=4;
 377   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸ß
             -Ñ¹¹Ø
 378   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 379   5                      Var_Signal3=Var_Signal3|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 380   5              }
 381   4              if(((Count[i][1]<(35*Refresh_Time))&&(Count[i][2]<(35*Refresh_Time)))&&(i!=7))//µÚÆß¸öÌ½Í·Ö»ÓÐÁ½¸öÁ¿³Ì
 382   4              {
 383   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 384   5                Channel_Detector[i][1]=2;
 385   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸ß
             -Ñ¹¹Ø
 386   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 387   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 388   5              }
 389   4              Real_Count_Display[i]=(float)(Real_Count[i]);
 390   4              Real_Count_Display[i]*=5;
 391   4              Real_Count_Display[i]/=3;
 392   4              Display_Flag[i]=1;//ÔÊÐíÏÔÊ¾
 393   4              Channel_Display[i]=3;
 394   4              Real_Count[i]=0;
 395   4              if((Display_Flag[i]==1)&&((Real_Count_Display[i]/5)>5719)&&(Channel_Detector[i][0]==Channel_Detector[i
             -][1])&&(i<7))//Á¿³ÌÇÐ»»,¼ÓºóÁ½¾äÊÇ·ÀÖ¹ÖØ¸´»»µ²
 396   4              {
 397   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 398   5                Channel_Detector[i][1]=4;
 399   5                Display_Flag[i]=0;
 400   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸ß
             -Ñ¹¹Ø
 401   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 402   5                      Var_Signal3=Var_Signal3|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 403   5              }
 404   4              if((Display_Flag[i]==1)&&((Real_Count_Display[i]/5)>7447)&&(Channel_Detector[i][0]==Channel_Detector[i
             -][1])&&(i==7))//Á¿³ÌÇÐ»»,¼ÓºóÁ½¾äÊÇ·ÀÖ¹ÖØ¸´»»µ²
 405   4              {
 406   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 407   5                Channel_Detector[i][1]=4;
 408   5                Display_Flag[i]=0;
 409   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸ß
             -Ñ¹¹Ø
 410   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 9   

             -(8),¸ßµçÆ½
 411   5                      Var_Signal3=Var_Signal3|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 412   5              }
 413   4              if((Display_Flag[i]==1)&&((Real_Count_Display[i]/5)<35)&&(Channel_Detector[i][0]==Channel_Detector[i][
             -1])&&(i!=7))
 414   4              {
 415   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 416   5                Channel_Detector[i][1]=2;
 417   5                Display_Flag[i]=0;
 418   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸ß
             -Ñ¹¹Ø
 419   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 420   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 421   5              }
 422   4            }
 423   3            if((Channel_Detector[i][1]==2)&&(Calculated[i]==0))//DL1Á¿³Ì£¬5´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó
 424   3            {
 425   4              Count[i][0]=Count[i][1];
 426   4              Count[i][1]=Count[i][2];
 427   4              Count[i][2]=buf[4*i+5]*256+buf[4*i+4];
 428   4              Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]);
 429   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 430   4              if((Count[i][1]>(5411*Refresh_Time))&&(Count[i][2]>(5411*Refresh_Time)))//Á¿³ÌÇÐ»»
 431   4              {
 432   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 433   5                Channel_Detector[i][1]=3;
 434   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸ß
             -Ñ¹¹Ø
 435   5                      Var_Signal2=Var_Signal2|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 436   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 437   5              }
 438   4              if((Count[i][1]<(158*Refresh_Time))&&(Count[i][2]<(158*Refresh_Time)))
 439   4              {
 440   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 441   5                Channel_Detector[i][1]=1;
 442   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½¸ß
             -Ñ¹¿ª
 443   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),µÍµçÆ½
 444   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 445   5              }
 446   4                Real_Count_Display[i]=(float)(Real_Count[i]);
 447   4                Real_Count_Display[i]*=5;//ÕâÀïÊÇCP5S
 448   4                Real_Count_Display[i]/=Refresh_Time;
 449   4                Display_Flag[i]=1;//ÔÊÐíÏÔÊ¾
 450   4                Channel_Display[i]=2;
 451   4                Real_Count[i]=0;
 452   4                if((Display_Flag[i]==1)&&((Real_Count_Display[i]/5)>5411)&&(Channel_Detector[i][0]==Channel_Detector[
             -i][1]))//Á¿³ÌÇÐ»»
 453   4                {
 454   5                  Channel_Detector[i][0]=Channel_Detector[i][1];
 455   5                  Channel_Detector[i][1]=3;
 456   5                  Display_Flag[i]=0;
 457   5                  Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸
             -ßÑ¹¹Ø
 458   5                        Var_Signal2=Var_Signal2|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ1
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 10  

             -0(8),¸ßµçÆ½
 459   5                        Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ1
             -0(6),µÍµçÆ½
 460   5                }
 461   4                if((Display_Flag[i]==1)&&((Real_Count_Display[i]/5)<158)&&(Channel_Detector[i][0]==Channel_Detector[i
             -][1]))
 462   4                {
 463   5                  Channel_Detector[i][0]=Channel_Detector[i][1];
 464   5                  Channel_Detector[i][1]=1;
 465   5                  Display_Flag[i]=0;
 466   5                  Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½¸
             -ßÑ¹¿ª
 467   5                        Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ1
             -0(8),µÍµçÆ½
 468   5                        Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ1
             -0(6),µÍµçÆ½
 469   5                }
 470   4            }
 471   3            if((Channel_Detector[i][1]==1)&&(Calculated[i]==0))//GM2Á¿³Ì£¬10´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó£¬5´ÎÆ½»¬Æ½¾ù
 472   3            {
 473   4              Count[i][0]=Count[i][1];
 474   4              Count[i][1]=Count[i][2];
 475   4              Count[i][2]=buf[4*i+3]*256+buf[4*i+2];
 476   4              Real_Count[i]=(uint)(buf[4*i+3]*256+buf[4*i+2]);
 477   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 478   4              if((Count[i][0]>(6019*Refresh_Time))&&(Count[i][1]>(6019*Refresh_Time))&&(Count[i][2]>(6019*Refresh_Ti
             -me)))//Á¿³ÌÇÐ»»
 479   4              {
 480   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 481   5                Channel_Detector[i][1]=2;
 482   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬¸ßµçÆ½¸ß
             -Ñ¹¹Ø
 483   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),µÍµçÆ½
 484   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 485   5              }
 486   4              if((Count[i][0]<(1.32*Refresh_Time))&&(Count[i][1]<(1.32*Refresh_Time))&&(Count[i][2]<(1.32*Refresh_Ti
             -me)))
 487   4              {
 488   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 489   5                Channel_Detector[i][1]=0;
 490   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½¸ß
             -Ñ¹¿ª
 491   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),µÍµçÆ½
 492   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 493   5              }
 494   4              Real_Count[i]*=20;//»»ËãÎªCPM(×¢Òâ¶ÔÓ¦µÄÊÇ3ÃëµÄ Refresh Time)
 495   4              Average_Counts[i][Average_Times[i]]=Real_Count[i];
 496   4              Average_Times[i]+=1;
 497   4              if(Average_Times[i]<5)
 498   4              {
 499   5                switch(Average_Times[i])
 500   5                {
 501   6                  case 1: Real_Count_Display[i]=Average_Counts[i][0]; break;
 502   6                  case 2: Real_Count_Display[i]=Average_Counts[i][0]*0.4+Average_Counts[i][1]*0.6; break;
 503   6                  case 3: Real_Count_Display[i]=Average_Counts[i][0]*a3+Average_Counts[i][1]*a3+Average_Counts[i][2]*a
             -4; break;
 504   6                  case 4: Real_Count_Display[i]=Average_Counts[i][0]*a2+Average_Counts[i][1]*a2+Average_Counts[i][2]*a
             -3+Average_Counts[i][3]*a4; break;
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 11  

 505   6                }
 506   5                Display_Flag[i]=1;
 507   5                Channel_Display[i]=0;
 508   5              }
 509   4              if(Average_Times[i]==5)
 510   4              {
 511   5                Real_Count_Display[i]=Average_Counts[i][0]*a0+Average_Counts[i][1]*a1+Average_Counts[i][2]*a2+Average
             -_Counts[i][3]*a3+Average_Counts[i][4]*a4;
 512   5                for(j=0;j<4;j++)
 513   5                {
 514   6                  Average_Counts[i][j]=Average_Counts[i][j+1];
 515   6                }
 516   5                Average_Times[i]-=1;//ÎªÁËÈÃ´ÎÊý
 517   5                Display_Flag[i]=1;
 518   5                Channel_Display[i]=1;
 519   5              }
 520   4              //if(Count_Times[i]==2)
 521   4              //{
 522   4                //Average_Counts[i][Average_Times[i]]=Real_Count[i];//½«¼ÆÊýÂÊ¸³Öµ¸øÆ½¾ùÖµ
 523   4                //Average_Times[i]+=1;//Æ½»¬Æ½¾ù´ÎÊý¼Ó1
 524   4                //Count_Times[i]=0;
 525   4                //Real_Count[i]=0;
 526   4              //}
 527   4              //if((Average_Times[i]>=2)&&(Average_Times[i]<=5))//ÔÚÓÐ2¸ö¼ÆÊýÖµºó¿ªÊ¼ËãÆ½¾ùÖµ²¢ÏÔÊ¾
 528   4              //{
 529   4                //for(j=0;j<Average_Times[i];j++)
 530   4                //{
 531   4                  //Real_Count_Display[i]+=(float)(Average_Counts[i][j]);
 532   4                //}
 533   4                //Real_Count_Display[i]/=(float)(Average_Times[i]);
 534   4                //Real_Count_Display[i]*=(60/(Refresh_Time*2));//ÒòÎªÒª»»Ëã³ÉCPM
 535   4                //Display_Flag[i]=1;//ÔÊÐíÏÔÊ¾
 536   4                //Channel_Display[i]=0;
 537   4                //if(Average_Times[i]==5)
 538   4                //{
 539   4                  //for(j=0;j<(Average_Times[i]-1);j++)
 540   4                  //{
 541   4                    //Average_Counts[i][j]=Average_Counts[i][j+1];
 542   4                  //}
 543   4                  //Average_Times[i]-=1;//ÎªÁËÈÃ´ÎÊý
 544   4                //}
 545   4              //}
 546   4              //if((Display_Flag[i]==1)&&((Real_Count_Display[i]/60)>6019)&&(Channel_Detector[i][0]==Channel_Detecto
             -r[i][1]))//Á¿³ÌÇÐ»»
 547   4              //{
 548   4                //Channel_Detector[i][0]=Channel_Detector[i][1];
 549   4                //Channel_Detector[i][1]=2;
 550   4                //Display_Flag[i]=0;
 551   4                //Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 552   4                      //Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ
             -10(8),µÍµçÆ½
 553   4                      //Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ
             -10(6),µÍµçÆ½
 554   4              //}
 555   4              //if((Display_Flag[i]==1)&&((Real_Count_Display[i]/60)<1.32)&&(Channel_Detector[i][0]==Channel_Detecto
             -r[i][1]))
 556   4              //{
 557   4                //Channel_Detector[i][0]=Channel_Detector[i][1];
 558   4                //Channel_Detector[i][1]=0;
 559   4                //Display_Flag[i]=0;
 560   4                //Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬Îª¸ßµç
             -Æ½
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 12  

 561   4                      //Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ
             -10(8),µÍµçÆ½
 562   4                      //Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ
             -10(6),µÍµçÆ½
 563   4              //}
 564   4            }
 565   3            if((Channel_Detector[i][1]==0)&&(Calculated[i]==0))//GM1Á¿³Ì£¬2´Î¶¨Ê±¼ÆÊý3ÃëÏà¼Ó£¬5´ÎÆ½»¬Æ½¾ù
 566   3            {
 567   4              Count[i][0]=Count[i][1];
 568   4              Count[i][1]=Count[i][2];
 569   4              Count[i][2]=buf[4*i+3]*256+buf[4*i+2];
 570   4              Real_Count[i]=(uint)(buf[4*i+3]*256+buf[4*i+2]);
 571   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 572   4              if((Count[i][0]>(1.32*Refresh_Time))&&(Count[i][1]>(1.32*Refresh_Time))&&(Count[i][2]>(1.32*Refresh_Ti
             -me)))//Á¿³ÌÇÐ»»
 573   4              {
 574   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 575   5                Channel_Detector[i][1]=1;
 576   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½¸ß
             -Ñ¹¿ª
 577   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),µÍµçÆ½
 578   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 579   5              }
 580   4                Real_Count[i]*=20;//»»ËãÎªCPM(×¢Òâ¶ÔÓ¦µÄÊÇ3ÃëµÄ Refresh Time)
 581   4                Average_Counts[i][Average_Times[i]]=Real_Count[i];
 582   4                Average_Times[i]+=1;
 583   4                if(Average_Times[i]<5)
 584   4                {
 585   5                  switch(Average_Times[i])
 586   5                  {
 587   6                    case 1: Real_Count_Display[i]=Average_Counts[i][0]; break;
 588   6                    case 2: Real_Count_Display[i]=Average_Counts[i][0]*0.4+Average_Counts[i][1]*0.6; break;
 589   6                    case 3: Real_Count_Display[i]=Average_Counts[i][0]*a3+Average_Counts[i][1]*a3+Average_Counts[i][2]*
             -a4; break;
 590   6                    case 4: Real_Count_Display[i]=Average_Counts[i][0]*a2+Average_Counts[i][1]*a2+Average_Counts[i][2]*
             -a3+Average_Counts[i][3]*a4; break;
 591   6                  }
 592   5                  Display_Flag[i]=1;
 593   5                  Channel_Display[i]=0;
 594   5                }
 595   4                else if(Average_Times[i]==5)
 596   4                {
 597   5                  Real_Count_Display[i]=Average_Counts[i][0]*a0+Average_Counts[i][1]*a1+Average_Counts[i][2]*a2+Averag
             -e_Counts[i][3]*a3+Average_Counts[i][4]*a4;
 598   5                  for(j=0;j<4;j++)
 599   5                  {
 600   6                    Average_Counts[i][j]=Average_Counts[i][j+1];
 601   6                  }
 602   5                  Average_Times[i]-=1;//ÎªÁËÈÃ´ÎÊý
 603   5                  Display_Flag[i]=1;
 604   5                  Channel_Display[i]=0;
 605   5                }
 606   4                //if(Count_Times[i]==2)
 607   4                //{
 608   4                //  Average_Counts[i][Average_Times[i]]=Real_Count[i];//½«¼ÆÊýÂÊ¸³Öµ¸øÆ½¾ùÖµ
 609   4                //  Average_Times[i]+=1;//Æ½»¬Æ½¾ù´ÎÊý¼Ó1
 610   4                //  Count_Times[i]=0;
 611   4                //  Real_Count[i]=0;
 612   4                //}
 613   4                //if((Average_Times[i]>=2)&&(Average_Times[i]<=5))//ÔÚÓÐ2¸ö¼ÆÊýÖµºó¿ªÊ¼ËãÆ½¾ùÖµ²¢ÏÔÊ¾
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 13  

 614   4                //{
 615   4                  //for(j=0;j<Average_Times[i];j++)
 616   4                  //{
 617   4                    //Real_Count_Display[i]+=(float)(Average_Counts[i][j]);
 618   4                  //}
 619   4                  //Real_Count_Display[i]/=(float)(Average_Times[i]);
 620   4                  //Real_Count_Display[i]*=(60/(Refresh_Time*2));//ÒòÎªÒª»»Ëã³ÉCPM
 621   4                  //Display_Flag[i]=1;//ÔÊÐíÏÔÊ¾
 622   4                  //Channel_Display[i]=0;
 623   4                  //if(Average_Times[i]==5)
 624   4                  //{
 625   4                    //for(j=0;j<(Average_Times[i]-1);j++)
 626   4                    //{
 627   4                      //Average_Counts[i][j]=Average_Counts[i][j+1];
 628   4                    //}
 629   4                    //Average_Times[i]-=1;//ÎªÁËÈÃ´ÎÊý
 630   4                  //}
 631   4                //}
 632   4                //if((Display_Flag[i]==1)&&((Real_Count_Display[i]/60)>1.32)&&(Channel_Detector[i][0]==Channel_Detect
             -or[i][1]))//Á¿³ÌÇÐ»»
 633   4                //{
 634   4                  //Channel_Detector[i][0]=Channel_Detector[i][1];
 635   4                  //Channel_Detector[i][1]=1;
 636   4                  //Display_Flag[i]=0;
 637   4                  //Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬Îª¸ßµ
             -çÆ½
 638   4                        //Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊ
             -Ò10(8),µÍµçÆ½
 639   4                        //Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊ
             -Ò10(6),µÍµçÆ½
 640   4                //}
 641   4            }
 642   3          }
 643   2          else if(Channel_Detector[i][0]!=Channel_Detector[i][1])//µ±Ç°ºóÁ½´Î¼ÆÊýµÄÁ¿³Ì²»Ò»Ñù
 644   2          {
 645   3            if((Channel_Detector[i][1]==4)&&(Calculated[i]==0))//DL3Á¿³Ì£¬¶¨Ê±¼ÆÊýÒ»Ãë£¬Ö±½ÓÓÃÀ´¼ÆËã
 646   3            {
 647   4              for(k=0;k<=2;k++)//³õÊ¼»¯µ¥´ÎÌøµµÅÐ¶Ï±äÁ¿£¬·ÀÖ¹ÒâÍâ½µµµ
 648   4              {
 649   5                Count[i][k]=1000*Refresh_Time;//Ò»Ãë¼ÆÊýÊ¹Æä²»»»µµ
 650   5              }
 651   4              Real_Count[i]=0;//Ìø×ªµ½´ËÁ¿³ÌÐèÒªÇåÁã
 652   4              if(i<7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 653   4              {
 654   5                Count[i][2]=buf[4*i+5]*256+buf[4*i+4];
 655   5                Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]);
 656   5              }
 657   4              else if(i==7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 658   4              {
 659   5                Count[i][2]=buf[31]*256+buf[30];
 660   5                Real_Count[i]=(uint)(buf[31]*256+buf[30]);
 661   5              }
 662   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 663   4              Real_Count_Display[i]=(float)((Real_Count[i]*5)/Refresh_Time);
 664   4              Display_Flag[i]=1;//Ö±½ÓÔÊÐíÏÔÊ¾
 665   4              Channel_Display[i]=4;
 666   4              Channel_Detector[i][0]=Channel_Detector[i][1];//¸üÐÂÁ¿³ÌÀúÊ·×´Ì¬
 667   4            }
 668   3            if((Channel_Detector[i][1]==3)&&(Calculated[i]==0))//DL2Á¿³Ì£¬Á½´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó
 669   3            {
 670   4              for(k=0;k<=2;k++)
 671   4              {
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 14  

 672   5                Count[i][k]=2000*Refresh_Time;//Ò»Ãë¼ÆÊýÊ¹Æä²»»»µµ
 673   5              }
 674   4              Real_Count[i]=0;//Ìø×ªÁ¿³ÌºóÐèÒªÇåÁã
 675   4              Display_Flag[i]=0;//ÏÔÊ¾¼°»»µ²±êÖ¾ÇåÁã
 676   4              if(i<7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 677   4              {
 678   5                Count[i][2]=buf[4*i+5]*256+buf[4*i+4];
 679   5                Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]);
 680   5              }
 681   4              else if(i==7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 682   4              {
 683   5                Count[i][2]=buf[31]*256+buf[30];
 684   5                Real_Count[i]=(uint)(buf[31]*256+buf[30]);
 685   5              }
 686   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 687   4              Channel_Detector[i][0]=Channel_Detector[i][1];//¸üÐÂÁ¿³ÌÀúÊ·×´Ì¬
 688   4            }
 689   3            if((Channel_Detector[i][1]==2)&&(Calculated[i]==0))//DL1Á¿³Ì£¬5´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó
 690   3            {
 691   4              for(k=0;k<=2;k++)
 692   4              {
 693   5                Count[i][k]=2000*Refresh_Time;//Ò»Ãë¼ÆÊýÊ¹Æä²»»»µµ
 694   5              }
 695   4              Real_Count[i]=0;//Ìø×ªÁ¿³ÌºóÐèÒªÇåÁã
 696   4              Display_Flag[i]=0;//ÏÔÊ¾¼°»»µ²±êÖ¾ÇåÁã
 697   4              if(i<7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 698   4              {
 699   5                Count[i][2]=buf[4*i+5]*256+buf[4*i+4];
 700   5                Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]);
 701   5              }
 702   4              else if(i==7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 703   4              {
 704   5                Count[i][2]=buf[31]*256+buf[30];
 705   5                Real_Count[i]=(uint)(buf[31]*256+buf[30]);
 706   5                Channel_Detector[i][1]=3;
 707   5                Channel_Detector[i][0]=3;
 708   5              }
 709   4      
 710   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 711   4              Channel_Detector[i][0]=Channel_Detector[i][1];//¸üÐÂÁ¿³ÌÀúÊ·×´Ì¬
 712   4            }
 713   3            if((Channel_Detector[i][1]==1)&&(Calculated[i]==0))//GM2Á¿³Ì£¬10´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó£¬5´ÎÆ½»¬Æ½¾ù
 714   3            {
 715   4              for(k=0;k<=2;k++)
 716   4              {
 717   5                Count[i][k]=1000*Refresh_Time;//Ò»Ãë¼ÆÊýÊ¹Æä²»»»µµ
 718   5              }
 719   4              Real_Count[i]=0;//Ìø×ªÁ¿³ÌºóÐèÒªÇåÁã
 720   4              Display_Flag[i]=0;//ÏÔÊ¾¼°»»µ²±êÖ¾ÇåÁã
 721   4              Average_Times[i]=0;//Æ½»¬Æ½¾ù´ÎÊýÇåÁã
 722   4              for(j=0;j<10;j++)
 723   4              {
 724   5                Average_Counts[i][j]=0;//Æ½»¬Æ½¾ùÇåÁã
 725   5              }
 726   4              Count[i][2]=buf[4*i+3]*256+buf[4*i+2];
 727   4              Real_Count[i]=(uint)(buf[4*i+3]*256+buf[4*i+2]);
 728   4              
 729   4              Real_Count[i]*=20;//»»ËãÎªCPM(×¢Òâ¶ÔÓ¦µÄÊÇ3ÃëµÄ Refresh Time)
 730   4              Average_Counts[i][Average_Times[i]]=Real_Count[i];
 731   4              Average_Times[i]+=1;
 732   4              Real_Count_Display[i]=Average_Counts[i][Average_Times[i]];
 733   4              Display_Flag[i]=1;
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 15  

 734   4              Channel_Display[i]=1;
 735   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 736   4              Channel_Detector[i][0]=Channel_Detector[i][1];//¸üÐÂÁ¿³ÌÀúÊ·×´Ì¬
 737   4            }
 738   3            if((Channel_Detector[i][1]==0)&&(Calculated[i]==0))//GM2Á¿³Ì£¬10´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó£¬5´ÎÆ½»¬Æ½¾ù
 739   3            {
 740   4              for(k=0;k<=2;k++)
 741   4              {
 742   5                Count[i][k]=1*Refresh_Time;//Ò»Ãë¼ÆÊýÊ¹Æä²»»»µµ
 743   5              }
 744   4              Real_Count[i]=0;//Ìø×ªÁ¿³ÌºóÐèÒªÇåÁã
 745   4              Display_Flag[i]=0;//ÏÔÊ¾¼°»»µ²±êÖ¾ÇåÁã
 746   4              Average_Times[i]=0;//Æ½»¬Æ½¾ù´ÎÊýÇåÁã
 747   4              for(j=0;j<10;j++)
 748   4              {
 749   5                Average_Counts[i][j]=0;//Æ½»¬Æ½¾ùÇåÁã
 750   5              }
 751   4              Count[i][2]=buf[4*i+3]*256+buf[4*i+2];
 752   4              Real_Count[i]=(uint)(buf[4*i+3]*256+buf[4*i+2]);
 753   4              Real_Count[i]*=20;//»»ËãÎªCPM(×¢Òâ¶ÔÓ¦µÄÊÇ3ÃëµÄ Refresh Time)
 754   4              Average_Counts[i][Average_Times[i]]=Real_Count[i];
 755   4              Average_Times[i]+=1;
 756   4              Real_Count_Display[i]=Average_Counts[i][Average_Times[i]];
 757   4              Display_Flag[i]=1;
 758   4              Channel_Display[i]=0;
 759   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 760   4              Channel_Detector[i][0]=Channel_Detector[i][1];//¸üÐÂÁ¿³ÌÀúÊ·×´Ì¬
 761   4            }
 762   3          }
 763   2        }
 764   1        /*½«¸ù¾Ý¼ÁÁ¿ÂÊÖµÖØÐÂÉèÖÃµÄÌ½Í·ÐÅºÅ¸Ä±ä±êÖ¾Ö´ÐÐ*/
 765   1        Signal1=Var_Signal1;//Ì½Í·ÐÅºÅ×ª±ä
 766   1        Signal2=Var_Signal3;//2016-8-26µ÷»»Var_Signal2,Var_Signal3£¬ÒòÎªÁ½ÕßÔÚÓ²¼þÉÏ±»Åª»ìÁË
 767   1        Signal3=Var_Signal2;
 768   1        /*AC1+ÔÚÕâÀïbuf(Ê®ÁùÎ»¸ßµÍ¼ÆÊýÊý¾Ý)Òª×ª»»³Éuint ÀàÐÍµÄTdataÊý¾Ý,²¢ÇÒÌ½Í·ÊýÄ¿ÒªÇå³þ
 769   1        ¼ÓÈëÑ¡Ì½Í·±êÖ¾*/
 770   1        if(measure_flag)                                                                //(1)measure_flagÔÚInit_
             -RAMÖÐ³õÊ¼»¯±äÎª1
 771   1        {
 772   2          for(j=0;j<8;j++)                                                       //(2)´æ¼ÆÊýÇøÎªbuf[3]-buf[32];Ì
             -½Í·¸öÊý±êÖ¾
 773   2          {
 774   3            Tdata=(uint)(Count[j][2]/3);                                                        //Ì½Í·¼ÆÊýÂÊuint
             - ,×ÏÉ«ÎªÈ«¾Ö±äÁ¿£¬À¶É«Îª¾Ö²¿±äÁ¿
 775   3            jtemp=0;                                                                    //float
 776   3            yudata=0;                                                                   //double
 777   3            mtemp=0;                                                                    //double
 778   3            yu=0;                                                                       //double
 779   3            Tbcd[5]=0;                                                                  //uchar Êý×é¹²12Î»£¬²âµÃ
             -µÄÊý¾ÝµÄbcdÂëÊý×é
 780   3            Tbcd[4]=0;
 781   3            Tbcd[3]=0;
 782   3            Tbcd[2]=0;
 783   3            Tbcd[1]=0;
 784   3            Tbcd[0]=0;
 785   3            m=j*10;                                                                     //±£Áô
 786   3            /*********ÅÐ¶Ï¼ÆÊýÂÊ***********/
 787   3            /*********Ç°Æß¸öÌ½Í·Ì½²âÆ÷ÉèÖÃ£¬È¡µÃ8253¼ÆÊýÖµ¼ÇÂ¼ÔÚTdata*/
 788   3            /**¡¾2024¡¿¸ù¾ÝÍ¨µÀÐòºÅ¼ÆËã±ê¶¨²ÎÊý£¬ÓÃÓÚCPMºÍ¼ÁÁ¿ÂÊµÄ×ª»»**/
 789   3          if(j<7)                                                                     //(3)Ç°Æß¸öÌ½Í·¼ÈÓÐµçÀëÊÒÒ²
             -ÓÐ¼ÆÊýÆ÷£¬µÚ°Ë¸öÖ»ÓÐµçÀëÊÒ¹Ê·Ö¿ª´¦Àí
 790   3            {
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 16  

 791   4                Display_Flag[j]=0;
 792   4            if(Channel_Display[j]==0)
 793   4            {
 794   5              Para[0]=(float)(DataThouth[m+1]*1000+DataCent[m+1]*100+DataTenth[m+1]*10+DataGe[m+1]);//µ÷½Ú²ÎÊý
 795   5              Para[1]=(float)((float)(DataThouth[m+2]*1000+DataCent[m+2]*100+DataTenth[m+2]*10+DataGe[m+2])/1000000)
             -;
 796   5              DoseRata[j]=(float)(Para[1]*((uint)Real_Count_Display[j]-Para[0]));
 797   5            }
 798   4            else if(Channel_Display[j]==1)
 799   4            {
 800   5              Para[2]=(float)(DataThouth[m+3]*1000+DataCent[m+3]*100+DataTenth[m+3]*10+DataGe[m+3]);//µ÷½Ú²ÎÊý
 801   5                  Para[3]=(float)((float)(DataThouth[m+4]*1000+DataCent[m+4]*100+DataTenth[m+4]*10+DataGe[m+4])/10
             -00000);
 802   5              DoseRata[j]=(float)(Para[3]*((uint)Real_Count_Display[j]-Para[2]));
 803   5            }
 804   4            else if(Channel_Display[j]==2)
 805   4            {
 806   5              Para[4]=(float)(DataThouth[m+5]*1000+DataCent[m+5]*100+DataTenth[m+5]*10+DataGe[m+5]);//µ÷½Ú²ÎÊý
 807   5                  Para[5]=(float)((float)(DataThouth[m+6]*1000+DataCent[m+6]*100+DataTenth[m+6]*10+DataGe[m+6])/10
             -00);
 808   5              DoseRata[j]=(float)(Para[5]*((uint)Real_Count_Display[j]-Para[4]));
 809   5            }
 810   4            else if(Channel_Display[j]==3)
 811   4            {
 812   5              Para[6]=(float)(DataThouth[m+7]*1000+DataCent[m+7]*100+DataTenth[m+7]*10+DataGe[m+7]);//µ÷½Ú²ÎÊý
 813   5                  Para[7]=(float)((float)(DataThouth[m+8]*1000+DataCent[m+8]*100+DataTenth[m+8]*10+DataGe[m+8])/10
             -);
 814   5              DoseRata[j]=(float)(Para[7]*((uint)Real_Count_Display[j]-Para[6]));
 815   5            }
 816   4            else if(Channel_Display[j]==4)
 817   4            {
 818   5              Para[8]=(float)(DataThouth[m+9]*1000+DataCent[m+9]*100+DataTenth[m+9]*10+DataGe[m+9]);//µ÷½Ú²ÎÊý
 819   5                  Para[9]=(float)((float)((DataThouth[m+10]*1000+DataCent[m+10]*100+DataTenth[m+10]*10+DataGe[m+10
             -])*10));
 820   5              DoseRata[j]=(float)(Para[9]*((uint)Real_Count_Display[j]-Para[8]));
 821   5            }
 822   4          }
 823   3          else if(j==7)
 824   3          {
 825   4            Display_Flag[j]=0;
 826   4            //Txtext(10,13+(j*58),"Dh");
 827   4            if(Channel_Display[j]==3)
 828   4            {
 829   5              Para[0]=(float)(DataThouth[m+1]*1000+DataCent[m+1]*100+DataTenth[m+1]*10+DataGe[m+1]);//µ÷½Ú²ÎÊý
 830   5              Para[1]=(float)((float)(DataThouth[m+2]*1000+DataCent[m+2]*100+DataTenth[m+2]*10+DataGe[m+2])/10);
 831   5              DoseRata[j]=(float)(Para[1]*((uint)Real_Count_Display[j]-Para[0]));
 832   5            }
 833   4            else if(Channel_Display[j]==4)
 834   4            {
 835   5              Para[2]=(float)(DataThouth[m+3]*1000+DataCent[m+3]*100+DataTenth[m+3]*10+DataGe[m+3]);//µ÷½Ú²ÎÊý
 836   5              Para[3]=(float)((float)(DataThouth[m+4]*1000+DataCent[m+4]*100+DataTenth[m+4]*10+DataGe[m+4])*10);
 837   5              DoseRata[j]=(float)(Para[3]*((uint)Real_Count_Display[j]-Para[2]));
 838   5            }
 839   4          }
 840   3            /**********µ¥Î»»»ËãºóÎªjtemp************/
 841   3            if(DoseRata[j]<0)                                                         //ÐÞ¸Ä2012.6.15Í¨¹ý¾ùÖµ¼ÆË
             -ã
 842   3            {
 843   4              jtemp=0.0;
 844   4              Flag_dw=1;
 845   4            }
 846   3            else if(DoseRata[j]>=0)                                                   //µ¥Î»ÎªuGy/h
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 17  

 847   3            {
 848   4              if(DoseRata[j]<1000)                                                    //Mean_Value<1000±íÊ¾µ¥Î»Î
             -ªuGy/h
 849   4              {
 850   5                jtemp=(float)DoseRata[j];
 851   5                Flag_dw=1;
 852   5              }
 853   4              else if((DoseRata[j]>=1000)&&(DoseRata[j]<1000000))                   //1000<Mean_Value<1000000±íÊ
             -¾mGy/h
 854   4              {
 855   5                jtemp=(float)(DoseRata[j]/1000);
 856   5                Flag_dw=2;
 857   5              }
 858   4              else if(DoseRata[j]>=1000000)                                           //Mean_Value>=1000000±íÊ¾G
             -y/h
 859   4              {
 860   5                jtemp=(float)(DoseRata[j]/1000000);
 861   5                Flag_dw=3;
 862   5              }
 863   4            }
 864   3            /*****DCS·¢ËÍÊý¾Ý×¼±¸****/
 865   3            if(DoseRata[j]<0)                                                         //Èô¼ÆËã¼ÁÁ¿Ð¡ÓÚÁãÏòDCS·¢Ë
             -Í0
 866   3            {
 867   4              DCS_Send[j*4+4]=0x30;
 868   4              DCS_Send[j*4+5]=0x30;
 869   4              DCS_Send[j*4+6]=0x30;
 870   4              DCS_Send[j*4+7]=0x30;
 871   4            }
 872   3            else if(DoseRata[j]>=0)
 873   3            {
 874   4              if(DoseRata[j]<1)
 875   4              {
 876   5                temp=(float)DoseRata[j]*1000;
 877   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 878   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 879   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 880   5                DCS_Send[j*4+7]=0x30;
 881   5              }
 882   4              else if((DoseRata[j]>=1)&&(DoseRata[j]<10))
 883   4              {
 884   5                temp=(float)DoseRata[j]*100;
 885   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 886   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 887   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 888   5                DCS_Send[j*4+7]=0x31;
 889   5              }
 890   4              else if((DoseRata[j]>=10)&&(DoseRata[j]<100))
 891   4              {
 892   5                temp=(float)DoseRata[j]*10;
 893   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 894   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 895   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 896   5                DCS_Send[j*4+7]=0x32;
 897   5              }
 898   4              else if((DoseRata[j]>=100)&&(DoseRata[j]<1000))
 899   4              {
 900   5                temp=(float)DoseRata[j];
 901   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 902   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 903   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 904   5                DCS_Send[j*4+7]=0x33;
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 18  

 905   5              }
 906   4              else if((DoseRata[j]>=1000)&&(DoseRata[j]<10000))
 907   4              {
 908   5                temp=(float)DoseRata[j]/10.0;
 909   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 910   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 911   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 912   5                DCS_Send[j*4+7]=0x34;
 913   5              }
 914   4              else if((DoseRata[j]>=10000)&&(DoseRata[j]<100000))
 915   4              {
 916   5                temp=(float)DoseRata[j]/100.0;
 917   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 918   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 919   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 920   5                DCS_Send[j*4+7]=0x35;
 921   5              }
 922   4              else if((DoseRata[j]>=100000)&&(DoseRata[j]<1000000))
 923   4              {
 924   5                temp=(float)DoseRata[j]/1000.0;
 925   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 926   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 927   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 928   5                DCS_Send[j*4+7]=0x36;
 929   5              }
 930   4              else if((DoseRata[j]>=1000000)&&(DoseRata[j]<10000000))
 931   4              {
 932   5                temp=(float)DoseRata[j]/10000.0;
 933   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 934   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 935   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 936   5                DCS_Send[j*4+7]=0x37;
 937   5              }
 938   4              else if((DoseRata[j]>=10000000)&&(DoseRata[j]<100000000))
 939   4              {
 940   5                temp=(float)DoseRata[j]/100000.0;
 941   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 942   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 943   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 944   5                DCS_Send[j*4+7]=0x38;
 945   5              }
 946   4              else if((DoseRata[j]>=100000000)&&(DoseRata[j]<1000000000))
 947   4              {
 948   5                temp=(float)DoseRata[j]/1000000.0;
 949   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 950   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 951   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 952   5                DCS_Send[j*4+7]=0x39;
 953   5              }
 954   4            }
 955   3            /***********¼ÁÁ¿ÂÊ×ª»»µ¥Î»ºó×ª»»³É¿ÉÒÔÏÔÊ¾µÄBCDÂë*************/
 956   3            if((Tbcd[5]<=9)&&(Tbcd[4]<=9)&&(Tbcd[3]<=9)&&(Tbcd[2]<=9)&&(Tbcd[1]<=9)&&(Tbcd[0]<=9))//4.21ËÆºõ¶àÓà
             -£¬¿É²»¿ÉÒÔÐÞ¸Äµô
 957   3            {
 958   4              Tbcd[5]=(uchar)(((int)jtemp)/100);                                         //°ÙÎ»
 959   4              Tbcd[4]=(uchar)(((int)jtemp)%100/10);                                      //Ê®Î»
 960   4              Tbcd[3]=(uchar)(((int)jtemp)%100%10);                                      //¸öÎ»
 961   4              count_temp=(jtemp-(int)jtemp)*1000;                                         //¼ÆËãÐ¡ÓÚ1µÄ²¿·Ö£¬°ÑÐ
             -¡Êý²¿·Ö±ä´ó£¬±£ÁôÈýÎ»Ð¡Êý
 962   4              Tbcd[2]=(uchar)(count_temp/100);                                           //Ð¡Ð¡ÊýÊ®·ÖÎ»
 963   4              Tbcd[1]=(uchar)(count_temp%100/10);                                        //Ð¡Êý°Ù·ÖÎ»
 964   4              Tbcd[0]=(uchar)(count_temp%100%10);                                        //Ð¡ÊýÇ§·ÖÎ»
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 19  

 965   4              if(Flag_dw==1)                                                              //¸ù¾ÝTbcd[]¼ÆËãyudeci
             -de(float)ÓÃÀ´ÅÐ¶Ï¼ÁÁ¿ÂÊÊÇ·ñ³¬¹ýãÐÖµ
 966   4                yudecide=(float)(Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001);
 967   4              if(Flag_dw==2)
 968   4                yudecide=(float)((Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001)*1000);
 969   4              if(Flag_dw==3)
 970   4                yudecide=(float)((Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001)*1000000
             -);
 971   4            }
 972   3            /***********ÅÐ¶ÏãÐÖµ*************/
 973   3            mtemp=(YuThouth[j]+YuCent[j]*0.1+YuTenth[j]*0.01);                          //ÔÝÊ±Ã»¸ù¾ÝÎ»ÊýÐÞ¸Ä2012
             -.6.15
 974   3            yu=(double)(pow(10,YuGe[j]));
 975   3            yudata=(double)(mtemp*yu);
 976   3            if(yudecide>=yudata)                                                        //Èç¹û¼ÆÊý³¬¹ýÄ³Ò»¸ö·¶Î§
             -£¬ÔòÉùÒô±¨¾¯
 977   3            {
 978   4              if((Judge_Speak==0)||(Speak_Alarm()==1))                                  //·äÃùÆ÷±¨¾¯£¬Speak_Alar
             -m·µ»Ø1·äÃùÆ÷¹¤×÷
 979   4              {
 980   5                Flag_Warn=1;                                                            //±¨¾¯±êÖ¾ÖÃÒ»
 981   5              }
 982   4              Flag_need_Flash[j]=1;                                                     //LEDÉÁË¸±êÖ¾ÖÃ1
 983   4              State_Flash[j]=1;
 984   4              Var_Led=Var_Led&Svar0[j];                                                 //LED±¨¾¯Ö¸Ê¾µÆ£¨char£©S
             -var0[8]={0xFE,0xFD,0xFB,0xF7,0xEF,0xDF,0xBF,0x7F}
 985   4            }
 986   3            else if(yudecide<yudata)
 987   3            {
 988   4              Flag_need_Flash[j]=0;
 989   4              State_Flash[j]=0;
 990   4              Var_Led=Var_Led|Svar1[j];
 991   4            }
 992   3            /*AI1*¼ÁÁ¿ÂÊÏÔÊ¾Ó¦µ±ÔÚÌ½²âÆ÷±êÖ¾¸Ä±äÖ®Ç°******¼ÁÁ¿ÂÊÏÔÊ¾**********/
 993   3          //if(Channel_Detector[j]==0)
 994   3          //{
 995   3            //  Txtext(10,13+(j*58),"Gh");                                                  //AH1ÏÔÊ¾Ì½Í·
 996   3          //}
 997   3          //else
 998   3          //{
 999   3          //Txtext(10,13+(j*58),"Dh");
1000   3          //}
1001   3          /*AI1*******¼ÁÁ¿ÂÊÏÔÊ¾**********/
1002   3          if(Flag_need_Flash[j]==0)
1003   3          {
1004   4            if((Channel_Display[j]==0)||(Channel_Display[j]==1))
1005   4          {
1006   5            Txtext(10,13+(j*58),"GM");                          //AH1ÏÔÊ¾Ì½Í·
1007   5          }
1008   4          else
1009   4          {
1010   5            Txtext(10,13+(j*58),"DL");
1011   5          }
1012   4              Tnumber(60,13+(j*58),j+1);                                                  //ÏÔÊ¾Ì½Í·ºÅ
1013   4              Txtext(90,13+(j*58),":");                                                   //ÏÔÊ¾Ã°ºÅ
1014   4            Tnumber(470,13+(j*58),Channel_Detector[j][1]);
1015   4            Tnumber(440,13+(j*58),Channel_Detector[j][0]);
1016   4            Tnumber(390,13+(j*58),Average_Times[j]);
1017   4              if(Tbcd[5]!=0)                                                              //Èô°ÙÎ»·ÇÁã£¬¸ù¾ÝÊýµÄ´
             -óÐ¡À´ÏÔÊ¾
1018   4              {
1019   5                Tnumber(130,13+(j*58),Tbcd[5]);
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 20  

1020   5                Tnumber(160,13+(j*58),Tbcd[4]);
1021   5                Tnumber(190,13+(j*58),Tbcd[3]);
1022   5                Txtext(220,13+(j*58),".");
1023   5                Tnumber(240,13+(j*58),Tbcd[2]);
1024   5                Tnumber(270,13+(j*58),Tbcd[1]);
1025   5                Tnumber(300,13+(j*58),Tbcd[0]);
1026   5                if(Tdata<10)                                                              //ÓÃÓÚÏÔÊ¾TdataËø´æµÄ¼Æ
             -ÊýÖµÏÔÊ¾
1027   5                Tnumber(576,13+(j*58),Tdata);                                             //²âÊÔÍê³ÉºóÈ¥µô2012.6.
             -24
1028   5                else if((Tdata>=10)&&(Tdata<100))
1029   5                Tnumber(556,13+(j*58),Tdata);
1030   5                else if((Tdata>=100)&&(Tdata<1000))
1031   5                Tnumber(536,13+(j*58),Tdata);
1032   5                else if((Tdata>=1000)&&(Tdata<10000))
1033   5                Tnumber(516,13+(j*58),Tdata);
1034   5                else if(Tdata>=10000)
1035   5                Tnumber(496,13+(j*58),Tdata);
1036   5              }
1037   4              else
1038   4              {
1039   5                if(Tbcd[4]!=0)                                                            //°ÙÎ»ÎªÁãÊ®Î»·ÇÁã
1040   5                {
1041   6                  Tnumber(160,13+(j*58),Tbcd[4]);
1042   6                  Tnumber(190,13+(j*58),Tbcd[3]);
1043   6                  Txtext(220,13+(j*58),".");
1044   6                  Tnumber(240,13+(j*58),Tbcd[2]);
1045   6                  Tnumber(270,13+(j*58),Tbcd[1]);
1046   6                  Tnumber(300,13+(j*58),Tbcd[0]);
1047   6                  if(Tdata<10)
1048   6                    Tnumber(576,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6.
             -24
1049   6                  else if((Tdata>=10)&&(Tdata<100))
1050   6                    Tnumber(556,13+(j*58),Tdata);
1051   6                  else if((Tdata>=100)&&(Tdata<1000))
1052   6                    Tnumber(536,13+(j*58),Tdata);
1053   6                  else if((Tdata>=1000)&&(Tdata<10000))
1054   6                    Tnumber(516,13+(j*58),Tdata);
1055   6                  else if(Tdata>=10000)
1056   6                    Tnumber(496,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6.
             -24
1057   6                }
1058   5                else                                                                      //°ÙÎ»Ê®Î»Î»¾ùÎªÁã£¬¸öÎ
             -»·ÇÁã
1059   5                {
1060   6                  Tnumber(190,13+(j*58),Tbcd[3]);
1061   6                  Txtext(220,13+(j*58),".");                                              //.Õ¼20¸öÏñËØ
1062   6                  Tnumber(240,13+(j*58),Tbcd[2]);                                         //Ò»¸öÊý×ÖÕ¼30¸öÏñËØ
1063   6                  Tnumber(270,13+(j*58),Tbcd[1]);
1064   6                  Tnumber(300,13+(j*58),Tbcd[0]);
1065   6                  if(Tdata<10)
1066   6                    Tnumber(576,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6.
             -24
1067   6                  else if((Tdata>=10)&&(Tdata<100))                                       //¿ÉÒÔ¿´¼ûÒ»¸öÊý×ÖÕ¼20Ï
             -ñËØ
1068   6                    Tnumber(556,13+(j*58),Tdata);
1069   6                  else if((Tdata>=100)&&(Tdata<1000))
1070   6                    Tnumber(536,13+(j*58),Tdata);
1071   6                  else if((Tdata>=1000)&&(Tdata<10000))
1072   6                    Tnumber(516,13+(j*58),Tdata);
1073   6                  else if(Tdata>=10000)
1074   6                    Tnumber(496,13+(j*58),Tdata);
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 21  

1075   6                }
1076   5            }
1077   4              /**********¼ÆÁ¿µ¥Î»ÏÔÊ¾***********/
1078   4              if(Flag_dw==1)                                                              //²âÊÔÍê³Éºó¼ÓÉÏ2012.6.
             -24
1079   4              {
1080   5                Txtext(340,13+(j*58),"u");
1081   5              }
1082   4              else if(Flag_dw==2)
1083   4              {
1084   5                Txtext(340,13+(j*58),"m");
1085   5              }
1086   4              else if(Flag_dw==3)
1087   4              {
1088   5                Txtext(340,13+(j*58),"G");
1089   5              }
1090   4              Alarm();                                                                    //±¨¾¯
1091   4            }
1092   3          if(Flag_need_Flash[j]==1)
1093   3          {
1094   4          if((Channel_Display[j]==0)||(Channel_Display[j]==1))
1095   4          {
1096   5            Trxtext(7,13+(j*58),"  ");
1097   5            Trxtext(10,13+(j*58),"GM                        ");                       //AH1ÏÔÊ¾Ì½Í·
1098   5          }
1099   4          else
1100   4          {
1101   5            Trxtext(7,13+(j*58),"  ");
1102   5            Trxtext(10,13+(j*58),"DL                        ");
1103   5          }
1104   4              Trnumber(60,13+(j*58),j+1);                                                  //ÏÔÊ¾Ì½Í·ºÅ
1105   4              Trxtext(90,13+(j*58),":");                                                   //ÏÔÊ¾Ã°ºÅ
1106   4            Trnumber(470,13+(j*58),Channel_Detector[j][1]);
1107   4            Trnumber(440,13+(j*58),Channel_Detector[j][0]);
1108   4            Trnumber(390,13+(j*58),Average_Times[j]);
1109   4              if(Tbcd[5]!=0)                                                              //Èô°ÙÎ»·ÇÁã£¬¸ù¾ÝÊýµÄ´
             -óÐ¡À´ÏÔÊ¾
1110   4              {
1111   5                Trnumber(130,13+(j*58),Tbcd[5]);
1112   5                Trnumber(160,13+(j*58),Tbcd[4]);
1113   5                Trnumber(190,13+(j*58),Tbcd[3]);
1114   5                Trxtext(220,13+(j*58),".");
1115   5                Trnumber(240,13+(j*58),Tbcd[2]);
1116   5                Trnumber(270,13+(j*58),Tbcd[1]);
1117   5                Trnumber(300,13+(j*58),Tbcd[0]);
1118   5                if(Tdata<10)                                                              //ÓÃÓÚÏÔÊ¾TdataËø´æµÄ¼Æ
             -ÊýÖµÏÔÊ¾
1119   5                Trnumber(576,13+(j*58),Tdata);                                             //²âÊÔÍê³ÉºóÈ¥µô2012.6
             -.24
1120   5                else if((Tdata>=10)&&(Tdata<100))
1121   5                Trnumber(556,13+(j*58),Tdata);
1122   5                else if((Tdata>=100)&&(Tdata<1000))
1123   5                Trnumber(536,13+(j*58),Tdata);
1124   5                else if((Tdata>=1000)&&(Tdata<10000))
1125   5                Trnumber(516,13+(j*58),Tdata);
1126   5                else if(Tdata>=10000)
1127   5                Trnumber(496,13+(j*58),Tdata);
1128   5              }
1129   4              else
1130   4              {
1131   5                if(Tbcd[4]!=0)                                                            //°ÙÎ»ÎªÁãÊ®Î»·ÇÁã
1132   5                {
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 22  

1133   6                  Trnumber(160,13+(j*58),Tbcd[4]);
1134   6                  Trnumber(190,13+(j*58),Tbcd[3]);
1135   6                  Trxtext(220,13+(j*58),".");
1136   6                  Trnumber(240,13+(j*58),Tbcd[2]);
1137   6                  Trnumber(270,13+(j*58),Tbcd[1]);
1138   6                  Trnumber(300,13+(j*58),Tbcd[0]);
1139   6                  if(Tdata<10)
1140   6                    Trnumber(576,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6
             -.24
1141   6                  else if((Tdata>=10)&&(Tdata<100))
1142   6                    Trnumber(556,13+(j*58),Tdata);
1143   6                  else if((Tdata>=100)&&(Tdata<1000))
1144   6                    Trnumber(536,13+(j*58),Tdata);
1145   6                  else if((Tdata>=1000)&&(Tdata<10000))
1146   6                    Trnumber(516,13+(j*58),Tdata);
1147   6                  else if(Tdata>=10000)
1148   6                    Trnumber(496,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6
             -.24
1149   6                }
1150   5                else                                                                      //°ÙÎ»Ê®Î»Î»¾ùÎªÁã£¬¸öÎ
             -»·ÇÁã
1151   5                {
1152   6                  Trnumber(190,13+(j*58),Tbcd[3]);
1153   6                  Trxtext(220,13+(j*58),".");                                              //.Õ¼20¸öÏñËØ
1154   6                  Trnumber(240,13+(j*58),Tbcd[2]);                                         //Ò»¸öÊý×ÖÕ¼30¸öÏñËØ
1155   6                  Trnumber(270,13+(j*58),Tbcd[1]);
1156   6                  Trnumber(300,13+(j*58),Tbcd[0]);
1157   6                  if(Tdata<10)
1158   6                    Trnumber(576,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6
             -.24
1159   6                  else if((Tdata>=10)&&(Tdata<100))                                       //¿ÉÒÔ¿´¼ûÒ»¸öÊý×ÖÕ¼20Ï
             -ñËØ
1160   6                    Trnumber(556,13+(j*58),Tdata);
1161   6                  else if((Tdata>=100)&&(Tdata<1000))
1162   6                    Trnumber(536,13+(j*58),Tdata);
1163   6                  else if((Tdata>=1000)&&(Tdata<10000))
1164   6                    Trnumber(516,13+(j*58),Tdata);
1165   6                  else if(Tdata>=10000)
1166   6                    Trnumber(496,13+(j*58),Tdata);
1167   6                }
1168   5            }
1169   4              /**********¼ÆÁ¿µ¥Î»ÏÔÊ¾***********/
1170   4              if(Flag_dw==1)                                                              //²âÊÔÍê³Éºó¼ÓÉÏ2012.6.
             -24
1171   4              {
1172   5                Trxtext(340,13+(j*58),"u");
1173   5              }
1174   4              else if(Flag_dw==2)
1175   4              {
1176   5                Trxtext(340,13+(j*58),"m");
1177   5              }
1178   4              else if(Flag_dw==3)
1179   4              {
1180   5                Trxtext(340,13+(j*58),"G");
1181   5              }
1182   4              Alarm();                                                                    //±¨¾¯
1183   4            }
1184   3            send_buf[8*j]=Tbcd[5];                                                      //ÏòNIM-B·¢ËÍÏÔÊ¾Êý¾Ý
1185   3            send_buf[8*j+1]=Tbcd[4];
1186   3            send_buf[8*j+2]=Tbcd[3];
1187   3            send_buf[8*j+3]=Tbcd[2];
1188   3            send_buf[8*j+4]=Tbcd[1];
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 23  

1189   3            send_buf[8*j+5]=Tbcd[0];
1190   3            send_buf[8*j+6]=Flag_dw;                                                    //·¢ËÍµ¥Î»±êÖ¾
1191   3            send_buf[8*j+7]=Flag_need_Flash[j];                                         //LEDÉÁË¸±êÖ¾
1192   3          }
1193   2          for(j=0;j<8;j++)                                                              //ÖÃDCSÊý¾ÝµÄ±¨¾¯ÐÅºÅ
1194   2          {
1195   3            if(Flag_need_Flash[j])
1196   3            {
1197   4              DCS_Send[64]=DCS_Send[64]|Svar1[j];
1198   4            }
1199   3            else
1200   3            {
1201   4              DCS_Send[64]=DCS_Send[64]&Svar0[j];
1202   4            }
1203   3          }                                                                             //8¸öÌ½Í·¾ùÏÔÊ¾Ö´ÐÐÍê
1204   2          Flag_Warn_Count=1;
1205   2          jishucount++;                                                                 //¼ÆÊý´ÎÊýÔö¼Ó£¨ËãÆ½¾ùÖµ
             -Ê±ÓÃ£©
1206   2          if(jishucount==255)                                                           //¼ÆÊý´ÎÊýÒòÎªÊÇcharÐÍ±ä
             -Á¿£¬×î¶àÖ§³Ö255¸ö£¬ËùÒÔÒªÖÃÁã
1207   2            jishucount=8;
1208   2          if(jishucount>4)
1209   2            Flag_Meant=1;                                                               //Ç°Îå´ÎµÄÈ¡Öµ²»Òª£¬µÚÎå
             -´Î²Å¿ªÊ¼Òª£¬ÖÃFlag_Meant=1£»·ñÔò¾ùÖÃ0
1210   2          else
1211   2            Flag_Meant=0;
1212   2          //shortdelay(5000);                                                             //ÑÓÊ±
1213   2          //for(i=0;i<33;i++)//ÏÔÊ¾ÍêÇå0
1214   2          //buf[i]=0;
1215   2        }                                                                               //²âÁ¿±êÖ¾
1216   1        else
1217   1        {
1218   2          jishuguan_data=0;                                                             //needthinkwhetherneed?4
             -.21,int¼ÆÊý¹ÜÊý¾Ý£¬
1219   2          dianlishi_data=0;                                                             //µçÀëÊÒÊý¾Ý
1220   2          jishuguan_rata=0;                                                             //¼ÆÊý¹Ü¼ÆÊýÂÊ
1221   2          jishuguan_jtemp=0;                                                            //¼ÆÊý¹Ü¼ÁÁ¿Öµ(µ¥Î»×ª»»º
             -ó)
1222   2          dianlishi_jtemp=0;                                                            //µçÀëÊÒ¼ÁÁ¿Öµ£¨µ¥Î»×ª»»
             -ºó£©
1223   2          Tbcd[11]=0;
1224   2          Tbcd[10]=0;
1225   2          Tbcd[9]=0;
1226   2          Tbcd[8]=0;
1227   2          Tbcd[7]=0;
1228   2          Tbcd[6]=0;
1229   2          Tbcd[5]=0;
1230   2          Tbcd[4]=0;
1231   2          Tbcd[3]=0;
1232   2          Tbcd[2]=0;
1233   2          Tbcd[1]=0;
1234   2          Tbcd[0]=0;
1235   2          j=10*biaoding_input-7;                                                        //biaodin_inputÎªÒª±ê¶¨µ
             -ÄÌ½Í·ÐòºÅ
1236   2          jishuguan_data=buf[4*biaoding_input-1]*256+buf[4*biaoding_input-2];       //Ïàµ±ÓÚTdata
1237   2          jishuguan_rata=jishuguan_data*12;                                             //¼ÆÊýÂÊ£¬Ö±½Ó³ËÒÔ12?
1238   2          dianlishi_data=buf[4*biaoding_input+1]*256+buf[4*biaoding_input];     //µçÀëÊÒTdata
1239   2          Para[0]=(float)(DataThouth[j]*1000+DataCent[j]*100+DataTenth[j]*10+DataGe[j]);//µ÷½Ú²ÎÊý
1240   2          Para[1]=(float)((float)(DataThouth[j+1]*1000+DataCent[j+1]*100+DataTenth[j+1]*10+DataGe[j+1])/1000000)
             -;
1241   2          jishuguan_DoseRata=(float)(Para[1]*(jishuguan_rata-Para[0]));
1242   2          if(jishuguan_DoseRata<0)
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 24  

1243   2            jishuguan_DoseRata=0.0;
1244   2          jishuguan_jtemp=(float)jishuguan_DoseRata;
1245   2          if((Tbcd[11]<=9)&&(Tbcd[10]<=9)&&(Tbcd[9]<=9)&&(Tbcd[8]<=9)&&(Tbcd[7]<=9)&&(Tbcd[6]<=9))//4.21ËÆºõ¶àÓà
             -£¬¿É²»¿ÉÒÔÐÞ¸Äµô
1246   2          {
1247   3            Tbcd[11]=(uchar)(((int)jishuguan_jtemp)/100);                               //Ç§Î»
1248   3            Tbcd[10]=(uchar)(((int)jishuguan_jtemp)%100/10);                            //°ÙÎ»
1249   3            Tbcd[9]=(uchar)(((int)jishuguan_jtemp)%100%10);                             //¸öÎ»
1250   3            jishuguan_count_temp=(jishuguan_jtemp-(int)jishuguan_jtemp)*1000;
1251   3            Tbcd[8]=(uchar)(jishuguan_count_temp/100);
1252   3            Tbcd[7]=(uchar)(jishuguan_count_temp%100/10);
1253   3            Tbcd[6]=(uchar)(jishuguan_count_temp%100%10);
1254   3          }
1255   2          Para[2]=(float)(DataThouth[j+2]*1000+DataCent[j+2]*100+DataTenth[j+2]*10+DataGe[j+2]);//µ÷½Ú²ÎÊý
1256   2          Para[3]=(float)((float)(DataThouth[j+3]*1000+DataCent[j+3]*100+DataTenth[j+3]*10+DataGe[j+3])/1000);
1257   2          dianlishi_DoseRata=(float)(Para[3]*(dianlishi_data-Para[2]));
1258   2          if(dianlishi_DoseRata<0)
1259   2            dianlishi_DoseRata=0.0;
1260   2          dianlishi_jtemp=(float)(dianlishi_DoseRata/1000);
1261   2          if((Tbcd[5]<=9)&&(Tbcd[4]<=9)&&(Tbcd[3]<=9)&&(Tbcd[2]<=9)&&(Tbcd[1]<=9)&&(Tbcd[0]<=9))//4.21ËÆºõ¶àÓà£¬
             -¿É²»¿ÉÒÔÐÞ¸Äµô
1262   2          {
1263   3            Tbcd[5]=(uchar)(((int)dianlishi_jtemp)/100);                                //Ç§Î»
1264   3            Tbcd[4]=(uchar)(((int)dianlishi_jtemp)%100/10);                             //°ÙÎ»
1265   3            Tbcd[3]=(uchar)(((int)dianlishi_jtemp)%100%10);                             //¸öÎ»
1266   3            dianlishi_count_temp=(dianlishi_jtemp-(int)dianlishi_jtemp)*1000;
1267   3            Tbcd[2]=(uchar)(dianlishi_count_temp/100);
1268   3            Tbcd[1]=(uchar)(dianlishi_count_temp%100/10);
1269   3            Tbcd[0]=(uchar)(dianlishi_count_temp%100%10);
1270   3          }
1271   2          Txtext(200,58,"±ê¶¨Ì½Í·");
1272   2          Tnumber(400,58,biaoding_input);
1273   2          Txtext(10,116,"¸Ç¸ï¹Ü");;
1274   2          Txtext(160,116,":");
1275   2          Txtext(220,174,"uGy/h");
1276   2          Txtext(520,174,"CPM");
1277   2          Txtext(10,290,"µçÀëÊÒ");;
1278   2          Txtext(160,290,":");
1279   2          Txtext(220,348,"mGy/h");
1280   2          Txtext(520,348,"CP5S");
1281   2          if(Tbcd[11]!=0)
1282   2          {
1283   3            Tnumber(10,174,Tbcd[11]);
1284   3            Tnumber(40,174,Tbcd[10]);
1285   3            Tnumber(70,174,Tbcd[9]);
1286   3            Txtext(100,174,".");
1287   3            Tnumber(130,174,Tbcd[8]);
1288   3            Tnumber(160,174,Tbcd[7]);
1289   3            Tnumber(190,174,Tbcd[6]);
1290   3            if(jishuguan_data<10)
1291   3              Tnumber(490,174,jishuguan_data);                                          //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1292   3            else if((jishuguan_data>=10)&&(jishuguan_data<100))
1293   3              Tnumber(460,174,jishuguan_data);
1294   3            else if((jishuguan_data>=100)&&(jishuguan_data<1000))
1295   3              Tnumber(430,174,jishuguan_data);
1296   3            else if((jishuguan_data>=1000)&&(jishuguan_data<10000))
1297   3              Tnumber(400,174,jishuguan_data);
1298   3            else if(jishuguan_data>=10000)
1299   3              Tnumber(370,174,jishuguan_data);
1300   3          }
1301   2          else
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 25  

1302   2          {
1303   3            if(Tbcd[10]!=0)
1304   3            {
1305   4              Tnumber(40,174,Tbcd[10]);
1306   4              Tnumber(70,174,Tbcd[9]);
1307   4              Txtext(100,174,".");
1308   4              Tnumber(130,174,Tbcd[8]);
1309   4              Tnumber(160,174,Tbcd[7]);
1310   4              Tnumber(190,174,Tbcd[6]);
1311   4              if(jishuguan_data<10)
1312   4              Tnumber(490,174,jishuguan_data);                                          //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1313   4              else if((jishuguan_data>=10)&&(jishuguan_data<100))
1314   4              Tnumber(460,174,jishuguan_data);
1315   4              else if((jishuguan_data>=100)&&(jishuguan_data<1000))
1316   4              Tnumber(430,174,jishuguan_data);
1317   4              else if((jishuguan_data>=1000)&&(jishuguan_data<10000))
1318   4              Tnumber(400,174,jishuguan_data);
1319   4              else if(jishuguan_data>=10000)
1320   4              Tnumber(370,174,jishuguan_data);
1321   4            }
1322   3            else
1323   3            {
1324   4              Tnumber(70,174,Tbcd[9]);
1325   4              Txtext(100,174,".");
1326   4              Tnumber(130,174,Tbcd[8]);
1327   4              Tnumber(160,174,Tbcd[7]);
1328   4              Tnumber(190,174,Tbcd[6]);
1329   4              if(jishuguan_data<10)
1330   4                Tnumber(490,174,jishuguan_data);                                        //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1331   4              else if((jishuguan_data>=10)&&(jishuguan_data<100))
1332   4                Tnumber(460,174,jishuguan_data);
1333   4              else if((jishuguan_data>=100)&&(jishuguan_data<1000))
1334   4                Tnumber(430,174,jishuguan_data);
1335   4              else if((jishuguan_data>=1000)&&(jishuguan_data<10000))
1336   4                Tnumber(400,174,jishuguan_data);
1337   4              else if(jishuguan_data>=10000)
1338   4                Tnumber(370,174,jishuguan_data);
1339   4            }
1340   3          }
1341   2          if(Tbcd[5]!=0)
1342   2          {
1343   3            Tnumber(10,348,Tbcd[5]);
1344   3            Tnumber(40,348,Tbcd[4]);
1345   3            Tnumber(70,348,Tbcd[3]);
1346   3            Txtext(100,348,".");
1347   3            Tnumber(130,348,Tbcd[2]);
1348   3            Tnumber(160,348,Tbcd[1]);
1349   3            Tnumber(190,348,Tbcd[0]);
1350   3            if(dianlishi_data<10)
1351   3              Tnumber(490,348,dianlishi_data);                                          //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1352   3            else if((dianlishi_data>=10)&&(dianlishi_data<100))
1353   3              Tnumber(460,348,dianlishi_data);
1354   3            else if((dianlishi_data>=100)&&(dianlishi_data<1000))
1355   3              Tnumber(430,348,dianlishi_data);
1356   3            else if((dianlishi_data>=1000)&&(dianlishi_data<10000))
1357   3              Tnumber(400,348,dianlishi_data);
1358   3            else if(dianlishi_data>=10000)
1359   3              Tnumber(370,348,dianlishi_data);
1360   3          }
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 26  

1361   2          else
1362   2          {
1363   3            if(Tbcd[4]!=0)
1364   3            {
1365   4              Tnumber(40,348,Tbcd[4]);
1366   4              Tnumber(70,348,Tbcd[3]);
1367   4              Txtext(100,348,".");
1368   4              Tnumber(130,348,Tbcd[2]);
1369   4              Tnumber(160,348,Tbcd[1]);
1370   4              Tnumber(190,348,Tbcd[0]);
1371   4              if(dianlishi_data<10)
1372   4                Tnumber(490,348,dianlishi_data);                                        //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1373   4              else if((dianlishi_data>=10)&&(dianlishi_data<100))
1374   4                Tnumber(460,348,dianlishi_data);
1375   4              else if((dianlishi_data>=100)&&(dianlishi_data<1000))
1376   4                Tnumber(430,348,dianlishi_data);
1377   4              else if((dianlishi_data>=1000)&&(dianlishi_data<10000))
1378   4                Tnumber(400,348,dianlishi_data);
1379   4              else if(dianlishi_data>=10000)
1380   4                Tnumber(370,348,dianlishi_data);
1381   4            }
1382   3            else
1383   3            {
1384   4              Tnumber(70,348,Tbcd[3]);
1385   4              Txtext(100,348,".");
1386   4              Tnumber(130,348,Tbcd[2]);
1387   4              Tnumber(160,348,Tbcd[1]);
1388   4              Tnumber(190,348,Tbcd[0]);
1389   4              if(dianlishi_data<10)
1390   4                Tnumber(490,348,dianlishi_data);                                        //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1391   4              else if((dianlishi_data>=10)&&(dianlishi_data<100))
1392   4                Tnumber(460,348,dianlishi_data);
1393   4              else if((dianlishi_data>=100)&&(dianlishi_data<1000))
1394   4                Tnumber(430,348,dianlishi_data);
1395   4              else if((dianlishi_data>=1000)&&(dianlishi_data<10000))
1396   4                Tnumber(400,348,dianlishi_data);
1397   4              else if(dianlishi_data>=10000)
1398   4                Tnumber(370,348,dianlishi_data);
1399   4            }
1400   3          }
1401   2        }
1402   1      }
1403          
1404          /************************************
1405          *¶ÌÑÓÊ±
1406          ************************************/
1407          void shortdelay(uint i)
1408          {
1409   1        uint k;
1410   1        uint n;
1411   1        for(k=0;k<i;k++)
1412   1          for(n=200;n>0;n--);
1413   1      }
1414          
1415          /********************************
1416          *Ö¸Ê¾µÆºÍ±¨¾¯
1417          ********************************/
1418          void Alarm()
1419          {
1420   1        uchar n;
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 27  

1421   1        for(n=0;n<10;n++)
1422   1        {
1423   2          Led573=Var_Led;
1424   2          if(Flag_Warn==1)                                                                  //ÉùÒô±¨¾¯
1425   2          {
1426   3            Speak=1;
1427   3          }
1428   2        }
1429   1      }
1430          
1431          /*******************************
1432          *¸üÐÂÖ¸Ê¾µÆ×´Ì¬
1433          *******************************/
1434          void Updata_Flash(uchar j)
1435          {
1436   1        if(Flag_need_Flash[j])
1437   1        {
1438   2          if(State_Flash[j]==1)
1439   2          {
1440   3            State_Flash[j]=0;
1441   3          }
1442   2          else
1443   2          {
1444   3            State_Flash[j]=1;
1445   3          }
1446   2        }
1447   1        else
1448   1        State_Flash[j]=0;
1449   1      }
1450          
1451          /***********************************
1452          *Ö¸Ê¾µÆÉÁË¸
1453          ************************************/
1454          void Led_Flash(void )
1455          {
1456   1        uchar i;
1457   1        for(i=0;i<8;i++)
1458   1        {
1459   2          Updata_Flash(i);                                                                  //×´Ì¬È¡·´
1460   2          Led_Disp(i,Flag_need_Flash[i],State_Flash[i]);                                    //µÆ×´Ì¬ÏÔÊ¾
1461   2        }
1462   1      }
1463          
1464          /************************************
1465          *Ö¸Ê¾µÆ×´Ì¬ÏÔÊ¾
1466          *************************************/
1467          void Led_Disp(uchar Num,uchar Flag,uchar State)
1468          {
1469   1        if(Flag)
1470   1        {
1471   2          if(State)
1472   2          {
1473   3            Var_Led=Var_Led&Svar0[Num];                                                       //Ö¸Ê¾µÆÁÁ
1474   3            Led573=Var_Led;
1475   3            if(Flag_Warn==1)                                                                  //ÐèÒª·äÃùÆ÷¹¤×÷
1476   3            {
1477   4              Speak=0;                                                                          //·äÃùÆ÷Ïì
1478   4              shortdelay(100);
1479   4            }
1480   3            return;
1481   3          }
1482   2        }
C51 COMPILER V9.60.7.0   8253COUNT                                                         03/13/2024 15:17:26 PAGE 28  

1483   1        Var_Led=Var_Led|Svar1[Num];                                                       //Ö¸Ê¾µÆÃð
1484   1        Led573=Var_Led;
1485   1        if(Flag_Warn==1)                                                                  //ÐèÒª·äÃùÆ÷¹¤×÷
1486   1        {
1487   2          Speak=1;                                                                          //·äÃùÆ÷²»Ïì
1488   2          shortdelay(100);
1489   2        }
1490   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  23323    ----
   CONSTANT SIZE    =    153    ----
   XDATA SIZE       =    611      41
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     48      24
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
