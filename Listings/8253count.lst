C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE 8253COUNT
OBJECT MODULE PLACED IN .\Objects\8253count.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE 8253count.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Li
                    -stings\8253count.lst) TABS(2) OBJECT(.\Objects\8253count.obj)

line level    source

   1          /********************************************************************************************
   2          *ÃèÊö£º
   3          *   8253¼ÆÊýÉèÖÃ
   4          *¹¦ÄÜ£º
   5          *   1.´Ó8253ÖÐ¶ÁÈ¡¼ÆÊý£¬Ã¿¸ö8253ÖÐº¬ÓÐ3¸ö¼ÆÊýÆ÷£¬Îå¸ö8253¼Æ15¸öÌ½Í·µÄ¼ÆÊý£¬
   6          *     Ç°Æß¸öÌ½Í·ÊÇË«Ì½Í·£¨µÍ¼ÆÊýÌ½Í·ºÍ¸ß¼ÆÊýÌ½Í·£©£¬µÚ°Ë¸öÌ½Í·ÊÇµ¥Ì½Í·£¨¸ß¼ÆÊýÌ½Í·£©£¬
   7          *     ¸ù¾Ý¼ÆÊýÂÊÑ¡ÔñÄÄ¸öÌ½Í·¹¤×÷£»
   8          *   2.T0¶¨Ê±ÖÐ¶Ï
   9          *     T0¹¤×÷ÔÚ16Î»×Ô¶¯ÖØÔØÄ£Ê½£¬ÏòÉÏ¼ÆÊý£¬Ã¿Ñ­»·Ò»´Î£¬×Ü¶¨Ê±5Ms,¼ÆÊý³õÖµDC00£¬¾§Õñ22.1184M£»
  10          *   3.¶¨Ê±µ½£¬¶ÁÈ¡¼ÆÊý£¬¸ù¾ÝÉè¶¨µÄ²ÎÊý£¬ÏÔÊ¾¸÷Ì½Í·µÄ¼ÆÊýÂÊ£»
  11          *   4.¸ù¾Ý¼ÆÊýÂÊµÄ²»Í¬£¬Ñ¡Ôñ²»Í¬µÄµ¥Î»£¨uGy/s,mGy/s,Gy/s£©;
  12          
  13          ***********************************************************************************************/
  14          #include "STC15F2K60S2.h"
  15          #include "intrins.h"
  16          #include "config.h"
  17          #include "absacc.h"
  18          #include "stdio.h"
  19          #include "math.h"
  20          
  21          #define C82531C XBYTE[0x8300]                                       //8253µÄÃüÁî¶Ë¿Ú£¨µØÖ·£©£¬CS4=1,CS3=1,
             -CS2=1,CS1=1,CS0=0,A1A0=11£»
  22          #define C825310D XBYTE[0x8000]                                      //¼ÆÊýÆ÷0CS4=1,CS3=1,CS2=1,CS1=1,CS0=0
             -,A1A0=00£»
  23          #define C825311D XBYTE[0x8100]                                      //¼ÆÊýÆ÷1CS4=1,CS3=1,CS2=1,CS1=1,CS0=0
             -,A1A0=01;
  24          #define C825312D XBYTE[0x8200]                                      //¼ÆÊýÆ÷2CS4=1,CS3=1,CS2=1,CS1=1,CS0=0
             -,A1A0=10;
  25          
  26          #define C82532C XBYTE[0x8b00]                                       // XBYTEµÄ×÷ÓÃÊÇ½«Íâ²¿I/O¶Ë¿ÚÖÃÎªÖÐÀ¨º
             -ÅÄÚ²¿µÄ16Î»¶þ½øÖÆ£¬¼´ÎªÉèÖÃ
  27          #define C825320D XBYTE[0x8800]                                      //Ê¹ÄÜ¶Ë£¬ XBYTEµÄ×÷ÓÃ»¹ÓÐÉèÖÃÊ¹ÄÜ¶Ëºó
             -£¬×Ô¶¯ÉèÖÃwr,rd.
  28          #define C825321D XBYTE[0x8900]
  29          #define C825322D XBYTE[0x8a00]
  30          
  31          #define C82533C XBYTE[0x9300]
  32          #define C825330D XBYTE[0x9000]
  33          #define C825331D XBYTE[0x9100]
  34          #define C825332D XBYTE[0x9200]
  35          
  36          #define C82534C XBYTE[0x9b00]
  37          #define C825340D XBYTE[0x9800]
  38          #define C825341D XBYTE[0x9900]
  39          #define C825342D XBYTE[0x9a00]
  40          
  41          #define C82535C XBYTE[0xa300]
  42          #define C825350D XBYTE[0xa000]
  43          #define C825351D XBYTE[0xa100]
  44          #define C825352D XBYTE[0xa200]
  45          
  46          uchar buf[32];                                                          //AB1*´Ó8253ÖÐ¶Áµ½µÄ¼ÆÊýÆ÷Êý¾Ý£¬15
             -¸ö¼ÆÊýÆ÷£¬µÍ°ËÎ»¸ß°ËÎ»£¬´Ó3-32£¬1ÎªÌ½Í·¸öÊý£¬2Îª²âÁ¿Ê±¼ä
  47          uchar Channel_Detector[8][2];                                                     //AC1+Í¨µÀÌ½Í·Ñ¡Ôñ±êÖ¾£¬
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 2   

             -1:µçÀëÊÒ0:¼ÆÊý¹Ü
  48          uchar DataGe[75];                                                                 //Ì½²âÆ÷±ê¶¨²ÎÊýµÄ¸öÎ»£¬
             -³õÊ¼Ê±¸öÊ®°ÙÇ§¾ùÎª0
  49          uchar DataTenth[75];                                                              //Ì½²âÆ÷±ê¶¨²ÎÊýµÄÊ®·ÖÎ»
  50          uchar DataCent[75];                                                               //Ì½²âÆ÷±ê¶¨²ÎÊýµÄ°Ù·ÖÎ»
  51          uchar DataThouth[75];                                                             //Ì½²âÆ÷±ê¶¨²ÎÊýµÄÇ§·ÖÎ»
  52          uchar send_buf[65];                                                               //NIM_AÏòNIM_B·¢ËÍÊý¾ÝµÄ
             -Êý×é
  53          uchar Incinput;                                                                   //Ì½Í·¸öÊý±êÖ¾£¬Ä¬ÈÏÏÔÊ¾
             -Ì½Í·¸öÊýÎª8¸ö
  54          float idata Para[10];                                                             //Éè¶¨ºÃµÄ²ÎÊýÊý×é
  55          float DoseRata[8];                                                                //Ã¿×éÌ½Í·²âµÃµÄ¼ÁÁ¿ÂÊ
  56          uchar Channel_Display[8];                             //ÓÃÓÚÏÔÊ¾µÄÍ¨µÀÁ¿³Ì
  57          float jishuguan_DoseRata;
  58          float dianlishi_DoseRata;
  59          uchar Calculated[8];                                                              //ÊÇ·ñ¼ÆËã¹ý±êÖ¾
  60          uchar Flag_dw;                                                                    //µ¥Î»±êÖ¾
  61          uchar Max_Time;                                                                   //AA1+ËùÓÐÍ¨µÀ×î³¤µÄ¼ÆÊý
             -Ê±¼ä
  62          uint Tdata;                                                                 //Ì½Í·¼ÆÊýÂÊ
  63          uint Real_Count[8];
  64          ulong Count[8][3];                                  //Ò»Ãë¼ÆÊýÀúÊ·
  65          uint idata jishuguan_data;                                                        //±ê¶¨Ê±µÄ¼ÆÊý¹Ü¼ÆÊýÖµÏà
             -µ±ÓÚTdata
  66          uint idata dianlishi_data;                                                        //±ê¶¨Ê±µÄµçÀëÊÒ¼ÆÊýÖµÏà
             -µ±ÓÚTdata
  67          uchar idata Var_Signal1;                                                          //Ì½Í·¿ØÖÆÐÅºÅ1£¬½Ó¼ÆÊý¹
             -Ü£¬Ä¬ÈÏff¾ù½Ó¼ÆÊý¹Ü
  68          uchar idata Var_Signal2;                                                          //Ì½Í·¿ØÖÆÐÅºÅ2£¬½ÓµçÀëÊ
             -Ò£¬Ä¬ÈÏ00£»
  69          uchar idata Var_Signal3;                                                          //Ì½Í·¿ØÖÆÐÅºÅ3£¬½ÓµçÀëÊ
             -Ò£¬Ä¬ÈÏ00£»
  70          uchar idata Var_Led;                                                              //LED±¨¾¯Ö¸Ê¾µÆ,Îª1Ê±Ãð,
             -³õÖµ0xff,
  71          uchar biaoding_input;
  72          bit Flag_Warn_Count;                                                              //Ä¬ÈÏ0£»
  73          uchar Flag_need_Flash[8];                                                         //LEDÉÁË¸±êÖ¾
  74          uchar State_Flash[8];
  75          uchar count_change_flag[8];                                                       //¼ÆÊý¸Ä±ä±êÖ¾£¿
  76          float code a0=0.0625;
  77          float code a1=0.0625;
  78          float code a2=0.125;
  79          float code a3=0.25;
  80          float code a4=0.5;
  81          uchar code Svar1[8]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};                   //ÐÅºÅÊý×é
  82          uchar code Svar0[8]={0xFE,0xFD,0xFB,0xF7,0xEF,0xDF,0xBF,0x7F};
  83          extern uchar jishucount;
  84          extern uchar  Average_Times[8];                         //AJ1+»¬¶¯Æ½¾ù´ÎÊý
  85          extern uchar Display_Flag[8];
  86          
  87          extern bit Speak_Alarm();
  88          
  89          
  90          
  91          void shortdelay(uint i);
  92          void Alarm();
  93          void Led_Disp(uchar Num,uchar Flag,uchar State);
  94          void Updata_Flash(uchar j);
  95          extern bitSpeak_Alarm();
  96          /*************************************
  97          *8253¼ÆÊýÖµ
  98          **************************************/
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 3   

  99          void GetAndDisdata()                                                              //¼ÆÊýÍê³ÉºóµÚÒ»¸öÔËÐÐµÄ
             -³ÌÐò
 100          {
 101   1        uchar j;
 102   1        uchar th=0;
 103   1        uchar tl=0;                                                                        //bufÊý×é³õÊ¼»¯
 104   1        for(j=0;j<10;j++)
 105   1        {
 106   2          Para[j]=0;
 107   2        }
 108   1        for(j=0;j<8;j++)
 109   1        {
 110   2        Calculated[j]=0;
 111   2        }
 112   1        /*===========Ëø´æ8253µÄ¼ÆÊýÖµ==========*/
 113   1        C82531C=0x84;                                                                   //Ëø´æµÚÒ»Æ¬8253¼ÆÊýÆ÷2µ
             -Ä¼ÆÊýÖµ
 114   1        tl=C825312D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 115   1        buf[2]=0xff-tl;
 116   1        th=C825312D;
 117   1        buf[3]=0xff-th;
 118   1      
 119   1        C82531C=0x44;                                                                   //Ëø´æµÚÒ»Æ¬8253¼ÆÊýÆ÷1µ
             -Ä¼ÆÊýÖµ
 120   1        tl=C825311D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 121   1        buf[4]=0xff-tl;
 122   1        th=C825311D;
 123   1        buf[5]=0xff-th;
 124   1      
 125   1        C82531C=0x04;                                                                   //Ëø´æµÚÒ»Æ¬8253¼ÆÊýÆ÷0µ
             -Ä¼ÆÊýÖµ
 126   1        tl=C825310D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 127   1        buf[6]=0xff-tl;
 128   1        th=C825310D;
 129   1        buf[7]=0xff-th;
 130   1      
 131   1        C82532C=0x84;                                                                   //Ëø´æµÚ¶þÆ¬8253¼ÆÊýÆ÷2µ
             -Ä¼ÆÊýÖµ
 132   1        tl=C825322D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 133   1        buf[8]=0xff-tl;
 134   1        th=C825322D;
 135   1        buf[9]=0xff-th;
 136   1      
 137   1        C82532C=0x44;                                                                   //Ëø´æµÚ¶þÆ¬8253¼ÆÊýÆ÷1µ
             -Ä¼ÆÊýÖµ
 138   1        tl=C825321D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 139   1        buf[10]=0xff-tl;
 140   1        th=C825321D;
 141   1        buf[11]=0xff-th;
 142   1      
 143   1        C82532C=0x04;                                                                   //Ëø´æµÚ¶þÆ¬8253¼ÆÊýÆ÷0µ
             -Ä¼ÆÊýÖµ
 144   1        tl=C825320D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 145   1        buf[12]=0xff-tl;
 146   1        th=C825320D;
 147   1        buf[13]=0xff-th;
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 4   

 148   1      
 149   1        C82533C=0x84;                                                                   //Ëø´æµÚÈýÆ¬8253¼ÆÊýÆ÷2µ
             -Ä¼ÆÊýÖµ
 150   1        tl=C825332D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 151   1        buf[14]=0xff-tl;
 152   1        th=C825332D;
 153   1        buf[15]=0xff-th;
 154   1      
 155   1        C82533C=0x44;                                                                   //Ëø´æµÚÈýÆ¬8253¼ÆÊýÆ÷1µ
             -Ä¼ÆÊýÖµ
 156   1        tl=C825331D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 157   1        buf[16]=0xff-tl;
 158   1        th=C825331D;
 159   1        buf[17]=0xff-th;
 160   1      
 161   1        C82533C=0x04;                                                                   //Ëø´æµÚÈýÆ¬8253¼ÆÊýÆ÷0µ
             -Ä¼ÆÊýÖµ
 162   1        tl=C825330D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 163   1        buf[18]=0xff-tl;
 164   1        th=C825330D;
 165   1        buf[19]=0xff-th;
 166   1      
 167   1        C82534C=0x84;                                                                   //Ëø´æµÚËÄÆ¬8253¼ÆÊýÆ÷2µ
             -Ä¼ÆÊýÖµ
 168   1        tl=C825342D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 169   1        buf[20]=0xff-tl;
 170   1        th=C825342D;
 171   1        buf[21]=0xff-th;
 172   1      
 173   1        C82534C=0x44;                                                                   //Ëø´æµÚËÄÆ¬8253¼ÆÊýÆ÷1µ
             -Ä¼ÆÊýÖµ
 174   1        tl=C825341D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 175   1        buf[22]=0xff-tl;
 176   1        th=C825341D;
 177   1        buf[23]=0xff-th;
 178   1      
 179   1        C82534C=0x04;                                                                   //Ëø´æµÚËÄÆ¬8253¼ÆÊýÆ÷0µ
             -Ä¼ÆÊýÖµ
 180   1        tl=C825340D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 181   1        buf[24]=0xff-tl;
 182   1        th=C825340D;
 183   1        buf[25]=0xff-th;
 184   1      
 185   1        C82535C=0x84;                                                                   //Ëø´æµÚÎåÆ¬8253¼ÆÊýÆ÷2µ
             -Ä¼ÆÊýÖµ
 186   1        tl=C825352D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 187   1        buf[26]=0xff-tl;
 188   1        th=C825352D;
 189   1        buf[27]=0xff-th;
 190   1      
 191   1        C82535C=0x44;                                                                   //Ëø´æµÚÎåÆ¬8253¼ÆÊýÆ÷1µ
             -Ä¼ÆÊýÖµ
 192   1        tl=C825351D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 193   1        buf[28]=0xff-tl;
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 5   

 194   1        th=C825351D;
 195   1        buf[29]=0xff-th;
 196   1      
 197   1        C82535C=0x04;                                                                   //Ëø´æµÚÎåÆ¬8253¼ÆÊýÆ÷0µ
             -Ä¼ÆÊýÖµ
 198   1        tl=C825350D;                                                                    //read825316bitsdata(fir
             -stLthenH)
 199   1        buf[30]=0xff-tl;
 200   1        th=C825350D;
 201   1        buf[31]=0xff-th;
 202   1      
 203   1        buf[0]=Incinput;                                                                //Ì½Í·¸öÊý
 204   1        buf[1]=Max_Time;                                                              //²âÁ¿Ê±¼ä£¨Ë¢ÐÂÊ±¼ä±êÖ¾£©
 205   1      }
 206          /*******************************************
 207          *8253¼ÆÊýÆ÷³õÊ¼»¯
 208          ********************************************/
 209          void Init_8253()
 210          {
 211   1        uchar i;//AB1+
 212   1        //=======×°Èë³õÖµÔÙ¿ªÊ¼¼ÆÊý=======//
 213   1        C82531C=0xb4;                                                                   //10110100
 214   1        C825312D=0xff;                                                                  //10£ºÍ¨µÀ2,11£ºÏÈµÍ×Ö½Ú
             -ºó¸ß×Ö½Ú£¬010£º°´·½Ê½2¹¤×÷£¬0£º¶þ½øÖÆ¼ÆÊý¡£Ð´³õÖµ0xffºó¿ªÊ¼¼ÆÊý
 215   1        C825312D=0xff;
 216   1      
 217   1        C82531C=0x74;                                                                   //01110100
 218   1        C825311D=0xff;                                                                  //Í¬ÉÏ
 219   1        C825311D=0xff;
 220   1      
 221   1        C82531C=0x34;                                                                   //00110100
 222   1        C825310D=0xff;                                                                  //Ð´³õÖµÏÈµÍ×Ö½Úºó¸ß×Ö½Ú
             -82531Ð´³õÖµºó¾Í¿ªÊ¼¼ÆÊý
 223   1        C825310D=0xff;                                                                  //¶þÈýÐÐÓÃÀ´×°Èë³õÖµ
 224   1      
 225   1        C82532C=0xb4;                                                                   //10110100
 226   1        C825322D=0xff;
 227   1        C825322D=0xff;
 228   1      
 229   1        C82532C=0x74;                                                                   //01110100
 230   1        C825321D=0xff;
 231   1        C825321D=0xff;
 232   1      
 233   1        C82532C=0x34;                                                                   //00110100
 234   1        C825320D=0xff;
 235   1        C825320D=0xff;
 236   1      
 237   1        C82533C=0xb4;                                                                   //10110100
 238   1        C825332D=0xff;
 239   1        C825332D=0xff;
 240   1      
 241   1        C82533C=0x74;                                                                   //01110100
 242   1        C825331D=0xff;
 243   1        C825331D=0xff;
 244   1      
 245   1        C82533C=0x34;                                                                   //00110100
 246   1        C825330D=0xff;
 247   1        C825330D=0xff;
 248   1      
 249   1        C82534C=0xb4;                                                                   //10110100
 250   1        C825342D=0xff;
 251   1        C825342D=0xff;
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 6   

 252   1      
 253   1        C82534C=0x74;                                                                   //01110100
 254   1        C825341D=0xff;
 255   1        C825341D=0xff;
 256   1      
 257   1        C82534C=0x34;                                                                   //00110100
 258   1        C825340D=0xff;
 259   1        C825340D=0xff;
 260   1      
 261   1        C82535C=0xb4;                                                                   //10110100
 262   1        C825352D=0xff;
 263   1        C825352D=0xff;
 264   1      
 265   1        C82535C=0x74;                                                                   //01110100
 266   1        C825351D=0xff;
 267   1        C825351D=0xff;
 268   1      
 269   1        C82535C=0x34;                                                                   //00110100
 270   1        C825350D=0xff;
 271   1        C825350D=0xff;
 272   1        for(i=0;i<67;i++)
 273   1        {
 274   2          DCS_Send[i]=0;
 275   2        }
 276   1        for(i=0;i<=7;i++)
 277   1        {
 278   2          DoseRata[i] = 0;            //Ã¿×éÌ½Í·²âµÃµÄ¼ÁÁ¿ÂÊ
 279   2        }
 280   1        Var_Led=0xff;                                                                   //ledÖ¸Ê¾
 281   1        Led573=Var_Led;
 282   1        EX0=0;                                                                          //¹ØÍâ²¿ÖÐ¶Ï0
 283   1        /*¶¨Ê±¼ÆÊýÆ÷µÄ³õÊ¼»¯*/                                                                         //AJ1-,ÒÆ
             -¶¯ÖÁ¶¨Ê±ÖÐ¶ÏÀï¿ªGate,8253¿ªÆô¼ÆÊý
 284   1        Flag8253Cnting=1;
 285   1        NumT0=0;
 286   1      }
 287          /************************************
 288          *ÏÔÊ¾¼ÆÊý
 289          ************************************/
 290          void ShowData()
 291          {
 292   1        uchar i,m,j,k;                                                                    //AE1-:Var1ÓÃÀ´ÅÐ¶ÏÊ¹Ó
             -ÃµÄÌ½²âÆ÷µÄ¾Ö²¿±äÁ¿£¬Ïàµ±ÓÚChannel_Detector,²»ÔÙÐèÒª
 293   1        ulong count_temp,jishuguan_count_temp,dianlishi_count_temp;
 294   1        float idata temp,jtemp,yudecide,jishuguan_rata,jishuguan_jtemp,dianlishi_jtemp;
 295   1        double yu,yudata,mtemp;
 296   1        uchar Tbcd[12];                                                                 //²âµÃµÄÊý¾ÝµÄbcdÂëÊý×é
 297   1        Lcd_Clear();
 298   1        /*AC1+ÔÚÕâÀïbuf(Ê®ÁùÎ»¸ßµÍ¼ÆÊýÊý¾Ý)Òª×ª»»³Éuint ÀàÐÍµÄTdataÊý¾Ý,²¢ÇÒÌ½Í·ÊýÄ¿ÒªÇå³þ
 299   1        ¼ÓÈëÑ¡Ì½Í·±êÖ¾*/
 300   1        /*AJ1-,¸ÄÎªÐÂËã·¨
 301   1        for(i=0;i<=7;i++)                                                               //Æß¸öÌ½Í·Öð¸ö¼ì²â
 302   1        {
 303   1          if(i<7)
 304   1          {
 305   1            if(Channel_Detector[i]==0)                                                  //Èç¹ûÌ½Í·Ê¹ÓÃµÄÊÇµçÀëÊÒ
 306   1            {
 307   1                Real_Count[i]=buf[4*i+4]*256+buf[4*i+3];
 308   1            }
 309   1            else
 310   1            {
 311   1                Real_Count[i]=buf[4*i+6]*256+buf[4*i+5];
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 7   

 312   1            }
 313   1           }
 314   1          else
 315   1          {
 316   1              Real_Count[i]=buf[32]*256+buf[31];
 317   1          }
 318   1        }
 319   1        -----------------*/
 320   1        /*³ÌÐòËµÃ÷:
 321   1        **1,Îª±£Ö¤¼´Ê¹¶à¸öÍ¨µÀ²»ÔÚÍ¬Ò»Á¿³Ì£¬¸ßÁ¿³ÌµÄÍ¨µÀÒ²ÄÜÓÐÆäÏìÓ¦¸ü¿ìµÄ¸üÐÂËÙ¶È£¬³ÌÐòÒ»Ãë¼ÆÊýÒ»´Î£¬10Ãë¼ÆÊýÎª
             -Ê®´ÎÒ»Ãë¼ÆÊýµÄÏà¼Ó
 322   1        **  £¬¼ÁÁ¿ÂÊÏÔÊ¾Ò»ÃëË¢ÐÂÒ»´Î¡£
 323   1        **2,³ÌÐòÖÐ¼ÆÊýÂÊ¼ÆËã¡¢Á¿³Ì»»µ²¡¢¼ÁÁ¿¼ÆËãÏÔÊ¾¸÷²¿·Ö·Ö¿ªÖ´ÐÐ
 324   1        */
 325   1        for(i=0;i<=7;i++)                                                               //8¸öÌ½Í·Öð¸ö¼ì²â
 326   1        {
 327   2          if(Channel_Detector[i][0]==Channel_Detector[i][1])//µ±Ç°Ò»´ÎÁ¿³ÌºÍ´Ë´ÎÁ¿³ÌÒ»ÑùÊ±
 328   2          {
 329   3            if((Channel_Detector[i][1]==4)&&(Calculated[i]==0))//DL3Á¿³Ì£¬¶¨Ê±¼ÆÊý3Ãë£¬Ö±½ÓÓÃÀ´¼ÆËã
 330   3            {
 331   4              Real_Count[i]=0;//´ËÁ¿³ÌÃ¿´Î¶¼ÒªÇåÁã
 332   4              Count[i][0]=Count[i][1];
 333   4              Count[i][1]=Count[i][2];
 334   4              if(i<7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 335   4              {
 336   5                Count[i][2]=buf[4*i+5]*256+buf[4*i+4]-1;      //¼ÓÒ»ÊÇÒòÎªÔÚ¼ÆÊýÖÜÆÚÄÚ»áÓÉÓ²¼þ¸øÒ»¸öÂö³å
 337   5                Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]-1);
 338   5              }
 339   4              else if(i==7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 340   4              {
 341   5                Count[i][2]=buf[31]*256+buf[30]-1;
 342   5                Real_Count[i]=(uint)(buf[31]*256+buf[30]-1);
 343   5              }
 344   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 345   4              if((Count[i][1]<(37*Refresh_Time))&&(Count[i][2]<(37*Refresh_Time))&&(i<7))//Á¿³ÌÇÐ»»Ç°7¸öÌ½Í·ÅÐ¶¨Ìõ¼þ
 346   4              {
 347   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 348   5                Channel_Detector[i][1]=3;
 349   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 350   5                      Var_Signal2=Var_Signal2|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 351   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 352   5              }
 353   4              if((Count[i][1]<(28*Refresh_Time))&&(Count[i][2]<(28*Refresh_Time))&&(i==7))//Á¿³ÌÇÐ»»µÚ°Ë¸öÌ½Í·ÅÐ¶¨Ìõ
             -¼þ
 354   4              {
 355   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 356   5                Channel_Detector[i][1]=3;
 357   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 358   5                      Var_Signal2=Var_Signal2|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 359   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 360   5              }
 361   4              Real_Count_Display[i]=(float)((Real_Count[i]*5)/Refresh_Time);
 362   4              Channel_Display[i]=4;
 363   4              Display_Flag[i]=1;//Ö±½ÓÔÊÐíÏÔÊ¾
 364   4            }
 365   3            if((Channel_Detector[i][1]==3)&&(Calculated[i]==0))//DL2Á¿³Ì£¬Á½´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó
 366   3            {
 367   4              Count[i][0]=Count[i][1];
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 8   

 368   4              Count[i][1]=Count[i][2];
 369   4              if(i<7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 370   4              {
 371   5                Count[i][2]=buf[4*i+5]*256+buf[4*i+4]-1;
 372   5                Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]-1);
 373   5              }
 374   4              else if(i==7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 375   4              {
 376   5                Count[i][2]=buf[31]*256+buf[30]-1;
 377   5                Real_Count[i]=(uint)(buf[31]*256+buf[30]-1);
 378   5              }
 379   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 380   4              if((Count[i][1]>(5719*Refresh_Time))&&(Count[i][2]>(5719*Refresh_Time))&&(i<7))//Á¿³ÌÇÐ»»
 381   4              {
 382   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 383   5                Channel_Detector[i][1]=4;
 384   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 385   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 386   5                      Var_Signal3=Var_Signal3|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 387   5              }
 388   4              if((Count[i][1]>(7447*Refresh_Time))&&(Count[i][2]>(7447*Refresh_Time))&&(i==7))//Á¿³ÌÇÐ»»
 389   4              {
 390   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 391   5                Channel_Detector[i][1]=4;
 392   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 393   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 394   5                      Var_Signal3=Var_Signal3|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 395   5              }
 396   4              if(((Count[i][1]<(35*Refresh_Time))&&(Count[i][2]<(35*Refresh_Time)))&&(i!=7))//µÚÆß¸öÌ½Í·Ö»ÓÐÁ½¸öÁ¿³Ì
 397   4              {
 398   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 399   5                Channel_Detector[i][1]=2;
 400   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 401   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 402   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 403   5              }
 404   4              Real_Count_Display[i]=(float)(Real_Count[i]);
 405   4              Real_Count_Display[i]*=5;
 406   4              Real_Count_Display[i]/=3;
 407   4              Display_Flag[i]=1;//ÔÊÐíÏÔÊ¾
 408   4              Channel_Display[i]=3;
 409   4              Real_Count[i]=0;
 410   4              if((Display_Flag[i]==1)&&((Real_Count_Display[i]/5)>5719)&&(Channel_Detector[i][0]==Channel_Detector[i
             -][1])&&(i<7))//Á¿³ÌÇÐ»»,¼ÓºóÁ½¾äÊÇ·ÀÖ¹ÖØ¸´»»µ²
 411   4              {
 412   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 413   5                Channel_Detector[i][1]=4;
 414   5                Display_Flag[i]=0;
 415   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 416   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 417   5                      Var_Signal3=Var_Signal3|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 418   5              }
 419   4              if((Display_Flag[i]==1)&&((Real_Count_Display[i]/5)>7447)&&(Channel_Detector[i][0]==Channel_Detector[i
             -][1])&&(i==7))//Á¿³ÌÇÐ»»,¼ÓºóÁ½¾äÊÇ·ÀÖ¹ÖØ¸´»»µ²
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 9   

 420   4              {
 421   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 422   5                Channel_Detector[i][1]=4;
 423   5                Display_Flag[i]=0;
 424   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 425   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 426   5                      Var_Signal3=Var_Signal3|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 427   5              }
 428   4              if((Display_Flag[i]==1)&&((Real_Count_Display[i]/5)<35)&&(Channel_Detector[i][0]==Channel_Detector[i][
             -1])&&(i!=7))
 429   4              {
 430   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 431   5                Channel_Detector[i][1]=2;
 432   5                Display_Flag[i]=0;
 433   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 434   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 435   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 436   5              }
 437   4            }
 438   3            if((Channel_Detector[i][1]==2)&&(Calculated[i]==0))//DL1Á¿³Ì£¬5´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó
 439   3            {
 440   4              Count[i][0]=Count[i][1];
 441   4              Count[i][1]=Count[i][2];
 442   4              Count[i][2]=buf[4*i+5]*256+buf[4*i+4]-1;
 443   4              Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]-1);
 444   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 445   4              if((Count[i][1]>(5411*Refresh_Time))&&(Count[i][2]>(5411*Refresh_Time)))//Á¿³ÌÇÐ»»
 446   4              {
 447   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 448   5                Channel_Detector[i][1]=3;
 449   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 450   5                      Var_Signal2=Var_Signal2|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),¸ßµçÆ½
 451   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 452   5              }
 453   4              if((Count[i][1]<(158*Refresh_Time))&&(Count[i][2]<(158*Refresh_Time)))
 454   4              {
 455   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 456   5                Channel_Detector[i][1]=1;
 457   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬Îª¸ßµçÆ½
 458   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),µÍµçÆ½
 459   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 460   5              }
 461   4                Real_Count_Display[i]=(float)(Real_Count[i]);
 462   4                Real_Count_Display[i]*=5;//ÕâÀïÊÇCP5S
 463   4                Real_Count_Display[i]/=Refresh_Time;
 464   4                Display_Flag[i]=1;//ÔÊÐíÏÔÊ¾
 465   4                Channel_Display[i]=2;
 466   4                Real_Count[i]=0;
 467   4                if((Display_Flag[i]==1)&&((Real_Count_Display[i]/5)>5411)&&(Channel_Detector[i][0]==Channel_Detector[
             -i][1]))//Á¿³ÌÇÐ»»
 468   4                {
 469   5                  Channel_Detector[i][0]=Channel_Detector[i][1];
 470   5                  Channel_Detector[i][1]=3;
 471   5                  Display_Flag[i]=0;
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 10  

 472   5                  Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 473   5                        Var_Signal2=Var_Signal2|Svar1[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ1
             -0(8),¸ßµçÆ½
 474   5                        Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ1
             -0(6),µÍµçÆ½
 475   5                }
 476   4                if((Display_Flag[i]==1)&&((Real_Count_Display[i]/5)<158)&&(Channel_Detector[i][0]==Channel_Detector[i
             -][1]))
 477   4                {
 478   5                  Channel_Detector[i][0]=Channel_Detector[i][1];
 479   5                  Channel_Detector[i][1]=1;
 480   5                  Display_Flag[i]=0;
 481   5                  Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬Îª¸ßµçÆ
             -½
 482   5                        Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ1
             -0(8),µÍµçÆ½
 483   5                        Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ1
             -0(6),µÍµçÆ½
 484   5                }
 485   4            }
 486   3            if((Channel_Detector[i][1]==1)&&(Calculated[i]==0))//GM2Á¿³Ì£¬10´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó£¬5´ÎÆ½»¬Æ½¾ù
 487   3            {
 488   4              Count[i][0]=Count[i][1];
 489   4              Count[i][1]=Count[i][2];
 490   4              Count[i][2]=buf[4*i+3]*256+buf[4*i+2]-1;
 491   4              Real_Count[i]=(uint)(buf[4*i+3]*256+buf[4*i+2]-1);
 492   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 493   4              if((Count[i][0]>(6019*Refresh_Time))&&(Count[i][1]>(6019*Refresh_Time))&&(Count[i][2]>(6019*Refresh_Ti
             -me)))//Á¿³ÌÇÐ»»
 494   4              {
 495   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 496   5                Channel_Detector[i][1]=2;
 497   5                Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 498   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),µÍµçÆ½
 499   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 500   5              }
 501   4              if((Count[i][0]<(1.32*Refresh_Time))&&(Count[i][1]<(1.32*Refresh_Time))&&(Count[i][2]<(1.32*Refresh_Ti
             -me)))
 502   4              {
 503   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 504   5                Channel_Detector[i][1]=0;
 505   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬Îª¸ßµçÆ½
 506   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),µÍµçÆ½
 507   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 508   5              }
 509   4              Real_Count[i]*=20;//»»ËãÎªCPM(×¢Òâ¶ÔÓ¦µÄÊÇ3ÃëµÄ Refresh Time)
 510   4              Average_Counts[i][Average_Times[i]]=Real_Count[i];
 511   4              Average_Times[i]+=1;
 512   4              if(Average_Times[i]<5)
 513   4              {
 514   5                switch(Average_Times[i])
 515   5                {
 516   6                  case 1: Real_Count_Display[i]=Average_Counts[i][0]; break;
 517   6                  case 2: Real_Count_Display[i]=Average_Counts[i][0]*0.4+Average_Counts[i][1]*0.6; break;
 518   6                  case 3: Real_Count_Display[i]=Average_Counts[i][0]*a3+Average_Counts[i][1]*a3+Average_Counts[i][2]*a
             -4; break;
 519   6                  case 4: Real_Count_Display[i]=Average_Counts[i][0]*a2+Average_Counts[i][1]*a2+Average_Counts[i][2]*a
             -3+Average_Counts[i][3]*a4; break;
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 11  

 520   6                }
 521   5                Display_Flag[i]=1;
 522   5                Channel_Display[i]=0;
 523   5              }
 524   4              if(Average_Times[i]==5)
 525   4              {
 526   5                Real_Count_Display[i]=Average_Counts[i][0]*a0+Average_Counts[i][1]*a1+Average_Counts[i][2]*a2+Average
             -_Counts[i][3]*a3+Average_Counts[i][4]*a4;
 527   5                for(j=0;j<4;j++)
 528   5                {
 529   6                  Average_Counts[i][j]=Average_Counts[i][j+1];
 530   6                }
 531   5                Average_Times[i]-=1;//ÎªÁËÈÃ´ÎÊý
 532   5                Display_Flag[i]=1;
 533   5                Channel_Display[i]=1;
 534   5              }
 535   4              //if(Count_Times[i]==2)
 536   4              //{
 537   4                //Average_Counts[i][Average_Times[i]]=Real_Count[i];//½«¼ÆÊýÂÊ¸³Öµ¸øÆ½¾ùÖµ
 538   4                //Average_Times[i]+=1;//Æ½»¬Æ½¾ù´ÎÊý¼Ó1
 539   4                //Count_Times[i]=0;
 540   4                //Real_Count[i]=0;
 541   4              //}
 542   4              //if((Average_Times[i]>=2)&&(Average_Times[i]<=5))//ÔÚÓÐ2¸ö¼ÆÊýÖµºó¿ªÊ¼ËãÆ½¾ùÖµ²¢ÏÔÊ¾
 543   4              //{
 544   4                //for(j=0;j<Average_Times[i];j++)
 545   4                //{
 546   4                  //Real_Count_Display[i]+=(float)(Average_Counts[i][j]);
 547   4                //}
 548   4                //Real_Count_Display[i]/=(float)(Average_Times[i]);
 549   4                //Real_Count_Display[i]*=(60/(Refresh_Time*2));//ÒòÎªÒª»»Ëã³ÉCPM
 550   4                //Display_Flag[i]=1;//ÔÊÐíÏÔÊ¾
 551   4                //Channel_Display[i]=0;
 552   4                //if(Average_Times[i]==5)
 553   4                //{
 554   4                  //for(j=0;j<(Average_Times[i]-1);j++)
 555   4                  //{
 556   4                    //Average_Counts[i][j]=Average_Counts[i][j+1];
 557   4                  //}
 558   4                  //Average_Times[i]-=1;//ÎªÁËÈÃ´ÎÊý
 559   4                //}
 560   4              //}
 561   4              //if((Display_Flag[i]==1)&&((Real_Count_Display[i]/60)>6019)&&(Channel_Detector[i][0]==Channel_Detecto
             -r[i][1]))//Á¿³ÌÇÐ»»
 562   4              //{
 563   4                //Channel_Detector[i][0]=Channel_Detector[i][1];
 564   4                //Channel_Detector[i][1]=2;
 565   4                //Display_Flag[i]=0;
 566   4                //Var_Signal1=Var_Signal1&Svar0[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬µÍµçÆ½
 567   4                      //Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ
             -10(8),µÍµçÆ½
 568   4                      //Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ
             -10(6),µÍµçÆ½
 569   4              //}
 570   4              //if((Display_Flag[i]==1)&&((Real_Count_Display[i]/60)<1.32)&&(Channel_Detector[i][0]==Channel_Detecto
             -r[i][1]))
 571   4              //{
 572   4                //Channel_Detector[i][0]=Channel_Detector[i][1];
 573   4                //Channel_Detector[i][1]=0;
 574   4                //Display_Flag[i]=0;
 575   4                //Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬Îª¸ßµç
             -Æ½
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 12  

 576   4                      //Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ
             -10(8),µÍµçÆ½
 577   4                      //Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ
             -10(6),µÍµçÆ½
 578   4              //}
 579   4            }
 580   3            if((Channel_Detector[i][1]==0)&&(Calculated[i]==0))//GM1Á¿³Ì£¬2´Î¶¨Ê±¼ÆÊý3ÃëÏà¼Ó£¬5´ÎÆ½»¬Æ½¾ù
 581   3            {
 582   4              Count[i][0]=Count[i][1];
 583   4              Count[i][1]=Count[i][2];
 584   4              Count[i][2]=buf[4*i+3]*256+buf[4*i+2]-1;
 585   4              Real_Count[i]=(uint)(buf[4*i+3]*256+buf[4*i+2]-1);
 586   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 587   4              if((Count[i][0]>(1.32*Refresh_Time))&&(Count[i][1]>(1.32*Refresh_Time))&&(Count[i][2]>(1.32*Refresh_Ti
             -me)))//Á¿³ÌÇÐ»»
 588   4              {
 589   5                Channel_Detector[i][0]=Channel_Detector[i][1];
 590   5                Channel_Detector[i][1]=1;
 591   5                Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬Îª¸ßµçÆ½
 592   5                      Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(8),µÍµçÆ½
 593   5                      Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊÒ10
             -(6),µÍµçÆ½
 594   5              }
 595   4                Real_Count[i]*=20;//»»ËãÎªCPM(×¢Òâ¶ÔÓ¦µÄÊÇ3ÃëµÄ Refresh Time)
 596   4                Average_Counts[i][Average_Times[i]]=Real_Count[i];
 597   4                Average_Times[i]+=1;
 598   4                if(Average_Times[i]<5)
 599   4                {
 600   5                  switch(Average_Times[i])
 601   5                  {
 602   6                    case 1: Real_Count_Display[i]=Average_Counts[i][0]; break;
 603   6                    case 2: Real_Count_Display[i]=Average_Counts[i][0]*0.4+Average_Counts[i][1]*0.6; break;
 604   6                    case 3: Real_Count_Display[i]=Average_Counts[i][0]*a3+Average_Counts[i][1]*a3+Average_Counts[i][2]*
             -a4; break;
 605   6                    case 4: Real_Count_Display[i]=Average_Counts[i][0]*a2+Average_Counts[i][1]*a2+Average_Counts[i][2]*
             -a3+Average_Counts[i][3]*a4; break;
 606   6                  }
 607   5                  Display_Flag[i]=1;
 608   5                  Channel_Display[i]=0;
 609   5                }
 610   4                else if(Average_Times[i]==5)
 611   4                {
 612   5                  Real_Count_Display[i]=Average_Counts[i][0]*a0+Average_Counts[i][1]*a1+Average_Counts[i][2]*a2+Averag
             -e_Counts[i][3]*a3+Average_Counts[i][4]*a4;
 613   5                  for(j=0;j<4;j++)
 614   5                  {
 615   6                    Average_Counts[i][j]=Average_Counts[i][j+1];
 616   6                  }
 617   5                  Average_Times[i]-=1;//ÎªÁËÈÃ´ÎÊý
 618   5                  Display_Flag[i]=1;
 619   5                  Channel_Display[i]=0;
 620   5                }
 621   4                //if(Count_Times[i]==2)
 622   4                //{
 623   4                //  Average_Counts[i][Average_Times[i]]=Real_Count[i];//½«¼ÆÊýÂÊ¸³Öµ¸øÆ½¾ùÖµ
 624   4                //  Average_Times[i]+=1;//Æ½»¬Æ½¾ù´ÎÊý¼Ó1
 625   4                //  Count_Times[i]=0;
 626   4                //  Real_Count[i]=0;
 627   4                //}
 628   4                //if((Average_Times[i]>=2)&&(Average_Times[i]<=5))//ÔÚÓÐ2¸ö¼ÆÊýÖµºó¿ªÊ¼ËãÆ½¾ùÖµ²¢ÏÔÊ¾
 629   4                //{
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 13  

 630   4                  //for(j=0;j<Average_Times[i];j++)
 631   4                  //{
 632   4                    //Real_Count_Display[i]+=(float)(Average_Counts[i][j]);
 633   4                  //}
 634   4                  //Real_Count_Display[i]/=(float)(Average_Times[i]);
 635   4                  //Real_Count_Display[i]*=(60/(Refresh_Time*2));//ÒòÎªÒª»»Ëã³ÉCPM
 636   4                  //Display_Flag[i]=1;//ÔÊÐíÏÔÊ¾
 637   4                  //Channel_Display[i]=0;
 638   4                  //if(Average_Times[i]==5)
 639   4                  //{
 640   4                    //for(j=0;j<(Average_Times[i]-1);j++)
 641   4                    //{
 642   4                      //Average_Counts[i][j]=Average_Counts[i][j+1];
 643   4                    //}
 644   4                    //Average_Times[i]-=1;//ÎªÁËÈÃ´ÎÊý
 645   4                  //}
 646   4                //}
 647   4                //if((Display_Flag[i]==1)&&((Real_Count_Display[i]/60)>1.32)&&(Channel_Detector[i][0]==Channel_Detect
             -or[i][1]))//Á¿³ÌÇÐ»»
 648   4                //{
 649   4                  //Channel_Detector[i][0]=Channel_Detector[i][1];
 650   4                  //Channel_Detector[i][1]=1;
 651   4                  //Display_Flag[i]=0;
 652   4                  //Var_Signal1=Var_Signal1|Svar1[i];                                       //¿ØÖÆÐÅºÅ1½Ó¼ÆÊý¹Ü£¬Îª¸ßµ
             -çÆ½
 653   4                        //Var_Signal2=Var_Signal2&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊ
             -Ò10(8),µÍµçÆ½
 654   4                        //Var_Signal3=Var_Signal3&Svar0[i];                                       //¿ØÖÆÐÅºÅ2½ÓµçÀëÊ
             -Ò10(6),µÍµçÆ½
 655   4                //}
 656   4            }
 657   3          }
 658   2          else if(Channel_Detector[i][0]!=Channel_Detector[i][1])//µ±Ç°ºóÁ½´Î¼ÆÊýµÄÁ¿³Ì²»Ò»Ñù
 659   2          {
 660   3            if((Channel_Detector[i][1]==4)&&(Calculated[i]==0))//DL3Á¿³Ì£¬¶¨Ê±¼ÆÊýÒ»Ãë£¬Ö±½ÓÓÃÀ´¼ÆËã
 661   3            {
 662   4              for(k=0;k<=2;k++)//³õÊ¼»¯µ¥´ÎÌøµµÅÐ¶Ï±äÁ¿£¬·ÀÖ¹ÒâÍâ½µµµ
 663   4              {
 664   5                Count[i][k]=1000*Refresh_Time;//Ò»Ãë¼ÆÊýÊ¹Æä²»»»µµ
 665   5              }
 666   4              Real_Count[i]=0;//Ìø×ªµ½´ËÁ¿³ÌÐèÒªÇåÁã
 667   4              if(i<7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 668   4              {
 669   5                Count[i][2]=buf[4*i+5]*256+buf[4*i+4]-1;
 670   5                Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]-1);
 671   5              }
 672   4              else if(i==7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 673   4              {
 674   5                Count[i][2]=buf[31]*256+buf[30]-1;
 675   5                Real_Count[i]=(uint)(buf[31]*256+buf[30]-1);
 676   5              }
 677   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 678   4              Real_Count_Display[i]=(float)((Real_Count[i]*5)/Refresh_Time);
 679   4              Display_Flag[i]=1;//Ö±½ÓÔÊÐíÏÔÊ¾
 680   4              Channel_Display[i]=4;
 681   4              Channel_Detector[i][0]=Channel_Detector[i][1];//¸üÐÂÁ¿³ÌÀúÊ·×´Ì¬
 682   4            }
 683   3            if((Channel_Detector[i][1]==3)&&(Calculated[i]==0))//DL2Á¿³Ì£¬Á½´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó
 684   3            {
 685   4              for(k=0;k<=2;k++)
 686   4              {
 687   5                Count[i][k]=2000*Refresh_Time;//Ò»Ãë¼ÆÊýÊ¹Æä²»»»µµ
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 14  

 688   5              }
 689   4              Real_Count[i]=0;//Ìø×ªÁ¿³ÌºóÐèÒªÇåÁã
 690   4              Display_Flag[i]=0;//ÏÔÊ¾¼°»»µ²±êÖ¾ÇåÁã
 691   4              if(i<7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 692   4              {
 693   5                Count[i][2]=buf[4*i+5]*256+buf[4*i+4]-1;
 694   5                Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]-1);
 695   5              }
 696   4              else if(i==7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 697   4              {
 698   5                Count[i][2]=buf[31]*256+buf[30]-1;
 699   5                Real_Count[i]=(uint)(buf[31]*256+buf[30]-1);
 700   5              }
 701   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 702   4              Channel_Detector[i][0]=Channel_Detector[i][1];//¸üÐÂÁ¿³ÌÀúÊ·×´Ì¬
 703   4            }
 704   3            if((Channel_Detector[i][1]==2)&&(Calculated[i]==0))//DL1Á¿³Ì£¬5´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó
 705   3            {
 706   4              for(k=0;k<=2;k++)
 707   4              {
 708   5                Count[i][k]=2000*Refresh_Time;//Ò»Ãë¼ÆÊýÊ¹Æä²»»»µµ
 709   5              }
 710   4              Real_Count[i]=0;//Ìø×ªÁ¿³ÌºóÐèÒªÇåÁã
 711   4              Display_Flag[i]=0;//ÏÔÊ¾¼°»»µ²±êÖ¾ÇåÁã
 712   4              if(i<7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 713   4              {
 714   5                Count[i][2]=buf[4*i+5]*256+buf[4*i+4]-1;
 715   5                Real_Count[i]=(uint)(buf[4*i+5]*256+buf[4*i+4]-1);
 716   5              }
 717   4              else if(i==7)//Ç°6¸öÌ½Í·ºÍµÚÆß¸öÌ½Í·È¡¼ÆÊýÎ»ÖÃ²»Ò»Ñù
 718   4              {
 719   5                Count[i][2]=buf[31]*256+buf[30]-1;
 720   5                Real_Count[i]=(uint)(buf[31]*256+buf[30]-1);
 721   5                Channel_Detector[i][1]=3;
 722   5                Channel_Detector[i][0]=3;
 723   5              }
 724   4      
 725   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 726   4              Channel_Detector[i][0]=Channel_Detector[i][1];//¸üÐÂÁ¿³ÌÀúÊ·×´Ì¬
 727   4            }
 728   3            if((Channel_Detector[i][1]==1)&&(Calculated[i]==0))//GM2Á¿³Ì£¬10´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó£¬5´ÎÆ½»¬Æ½¾ù
 729   3            {
 730   4              for(k=0;k<=2;k++)
 731   4              {
 732   5                Count[i][k]=1000*Refresh_Time;//Ò»Ãë¼ÆÊýÊ¹Æä²»»»µµ
 733   5              }
 734   4              Real_Count[i]=0;//Ìø×ªÁ¿³ÌºóÐèÒªÇåÁã
 735   4              Display_Flag[i]=0;//ÏÔÊ¾¼°»»µ²±êÖ¾ÇåÁã
 736   4              Average_Times[i]=0;//Æ½»¬Æ½¾ù´ÎÊýÇåÁã
 737   4              for(j=0;j<10;j++)
 738   4              {
 739   5                Average_Counts[i][j]=0;//Æ½»¬Æ½¾ùÇåÁã
 740   5              }
 741   4              Count[i][2]=buf[4*i+3]*256+buf[4*i+2]-1;
 742   4              Real_Count[i]=(uint)(buf[4*i+3]*256+buf[4*i+2]-1);
 743   4              
 744   4              Real_Count[i]*=20;//»»ËãÎªCPM(×¢Òâ¶ÔÓ¦µÄÊÇ3ÃëµÄ Refresh Time)
 745   4              Average_Counts[i][Average_Times[i]]=Real_Count[i];
 746   4              Average_Times[i]+=1;
 747   4              Real_Count_Display[i]=Average_Counts[i][Average_Times[i]];
 748   4              Display_Flag[i]=1;
 749   4              Channel_Display[i]=1;
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 15  

 750   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 751   4              Channel_Detector[i][0]=Channel_Detector[i][1];//¸üÐÂÁ¿³ÌÀúÊ·×´Ì¬
 752   4            }
 753   3            if((Channel_Detector[i][1]==0)&&(Calculated[i]==0))//GM2Á¿³Ì£¬10´Î¶¨Ê±¼ÆÊýÒ»ÃëÏà¼Ó£¬5´ÎÆ½»¬Æ½¾ù
 754   3            {
 755   4              for(k=0;k<=2;k++)
 756   4              {
 757   5                Count[i][k]=1*Refresh_Time;//Ò»Ãë¼ÆÊýÊ¹Æä²»»»µµ
 758   5              }
 759   4              Real_Count[i]=0;//Ìø×ªÁ¿³ÌºóÐèÒªÇåÁã
 760   4              Display_Flag[i]=0;//ÏÔÊ¾¼°»»µ²±êÖ¾ÇåÁã
 761   4              Average_Times[i]=0;//Æ½»¬Æ½¾ù´ÎÊýÇåÁã
 762   4              for(j=0;j<10;j++)
 763   4              {
 764   5                Average_Counts[i][j]=0;//Æ½»¬Æ½¾ùÇåÁã
 765   5              }
 766   4              Count[i][2]=buf[4*i+3]*256+buf[4*i+2]-1;
 767   4              Real_Count[i]=(uint)(buf[4*i+3]*256+buf[4*i+2]-1);
 768   4              Real_Count[i]*=20;//»»ËãÎªCPM(×¢Òâ¶ÔÓ¦µÄÊÇ3ÃëµÄ Refresh Time)
 769   4              Average_Counts[i][Average_Times[i]]=Real_Count[i];
 770   4              Average_Times[i]+=1;
 771   4              Real_Count_Display[i]=Average_Counts[i][Average_Times[i]];
 772   4              Display_Flag[i]=1;
 773   4              Channel_Display[i]=0;
 774   4              Calculated[i]=1;//¼ÆËã¹ý±êÖ¾
 775   4              Channel_Detector[i][0]=Channel_Detector[i][1];//¸üÐÂÁ¿³ÌÀúÊ·×´Ì¬
 776   4            }
 777   3          }
 778   2        }
 779   1        /*½«¸ù¾Ý¼ÁÁ¿ÂÊÖµÖØÐÂÉèÖÃµÄÌ½Í·ÐÅºÅ¸Ä±ä±êÖ¾Ö´ÐÐ*/
 780   1        Signal1=Var_Signal1;//Ì½Í·ÐÅºÅ×ª±ä
 781   1        Signal2=Var_Signal3;//2016-8-26µ÷»»Var_Signal2,Var_Signal3£¬ÒòÎªÁ½ÕßÔÚÓ²¼þÉÏ±»Åª»ìÁË
 782   1        Signal3=Var_Signal2;
 783   1        /*AC1+ÔÚÕâÀïbuf(Ê®ÁùÎ»¸ßµÍ¼ÆÊýÊý¾Ý)Òª×ª»»³Éuint ÀàÐÍµÄTdataÊý¾Ý,²¢ÇÒÌ½Í·ÊýÄ¿ÒªÇå³þ
 784   1        ¼ÓÈëÑ¡Ì½Í·±êÖ¾*/
 785   1        if(measure_flag)                                                                //(1)measure_flagÔÚInit_
             -RAMÖÐ³õÊ¼»¯±äÎª1
 786   1        {
 787   2          for(j=0;j<8;j++)                                                       //(2)´æ¼ÆÊýÇøÎªbuf[3]-buf[32];Ì
             -½Í·¸öÊý±êÖ¾
 788   2          {
 789   3            Tdata=(uint)(Count[j][2]/3);                                                        //Ì½Í·¼ÆÊýÂÊuint
             - ,×ÏÉ«ÎªÈ«¾Ö±äÁ¿£¬À¶É«Îª¾Ö²¿±äÁ¿
 790   3            jtemp=0;                                                                    //float
 791   3            yudata=0;                                                                   //double
 792   3            mtemp=0;                                                                    //double
 793   3            yu=0;                                                                       //double
 794   3            Tbcd[5]=0;                                                                  //uchar Êý×é¹²12Î»£¬²âµÃ
             -µÄÊý¾ÝµÄbcdÂëÊý×é
 795   3            Tbcd[4]=0;
 796   3            Tbcd[3]=0;
 797   3            Tbcd[2]=0;
 798   3            Tbcd[1]=0;
 799   3            Tbcd[0]=0;
 800   3            m=j*10;                                                                     //±£Áô
 801   3            /*********ÅÐ¶Ï¼ÆÊýÂÊ***********/
 802   3            /*********Ç°Æß¸öÌ½Í·Ì½²âÆ÷ÉèÖÃ£¬È¡µÃ8253¼ÆÊýÖµ¼ÇÂ¼ÔÚTdata*/
 803   3          if(j<7)                                                                     //(3)Ç°Æß¸öÌ½Í·¼ÈÓÐµçÀëÊÒÒ²
             -ÓÐ¼ÆÊýÆ÷£¬µÚ°Ë¸öÖ»ÓÐµçÀëÊÒ¹Ê·Ö¿ª´¦Àí
 804   3            {
 805   4                Display_Flag[j]=0;
 806   4            if(Channel_Display[j]==0)
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 16  

 807   4            {
 808   5              Para[0]=(float)(DataThouth[m+1]*1000+DataCent[m+1]*100+DataTenth[m+1]*10+DataGe[m+1]);//µ÷½Ú²ÎÊý
 809   5              Para[1]=(float)((float)(DataThouth[m+2]*1000+DataCent[m+2]*100+DataTenth[m+2]*10+DataGe[m+2])/1000000)
             -;
 810   5              DoseRata[j]=(float)(Para[1]*((uint)Real_Count_Display[j]-Para[0]));
 811   5            }
 812   4            else if(Channel_Display[j]==1)
 813   4            {
 814   5              Para[2]=(float)(DataThouth[m+3]*1000+DataCent[m+3]*100+DataTenth[m+3]*10+DataGe[m+3]);//µ÷½Ú²ÎÊý
 815   5                  Para[3]=(float)((float)(DataThouth[m+4]*1000+DataCent[m+4]*100+DataTenth[m+4]*10+DataGe[m+4])/10
             -00000);
 816   5              DoseRata[j]=(float)(Para[3]*((uint)Real_Count_Display[j]-Para[2]));
 817   5            }
 818   4            else if(Channel_Display[j]==2)
 819   4            {
 820   5              Para[4]=(float)(DataThouth[m+5]*1000+DataCent[m+5]*100+DataTenth[m+5]*10+DataGe[m+5]);//µ÷½Ú²ÎÊý
 821   5                  Para[5]=(float)((float)(DataThouth[m+6]*1000+DataCent[m+6]*100+DataTenth[m+6]*10+DataGe[m+6])/10
             -00);
 822   5              DoseRata[j]=(float)(Para[5]*((uint)Real_Count_Display[j]-Para[4]));
 823   5            }
 824   4            else if(Channel_Display[j]==3)
 825   4            {
 826   5              Para[6]=(float)(DataThouth[m+7]*1000+DataCent[m+7]*100+DataTenth[m+7]*10+DataGe[m+7]);//µ÷½Ú²ÎÊý
 827   5                  Para[7]=(float)((float)(DataThouth[m+8]*1000+DataCent[m+8]*100+DataTenth[m+8]*10+DataGe[m+8])/10
             -);
 828   5              DoseRata[j]=(float)(Para[7]*((uint)Real_Count_Display[j]-Para[6]));
 829   5            }
 830   4            else if(Channel_Display[j]==4)
 831   4            {
 832   5              Para[8]=(float)(DataThouth[m+9]*1000+DataCent[m+9]*100+DataTenth[m+9]*10+DataGe[m+9]);//µ÷½Ú²ÎÊý
 833   5                  Para[9]=(float)((float)((DataThouth[m+10]*1000+DataCent[m+10]*100+DataTenth[m+10]*10+DataGe[m+10
             -])*10));
 834   5              DoseRata[j]=(float)(Para[9]*((uint)Real_Count_Display[j]-Para[8]));
 835   5            }
 836   4          }
 837   3          else if(j==7)
 838   3          {
 839   4            Display_Flag[j]=0;
 840   4            //Txtext(10,13+(j*58),"Dh");
 841   4            if(Channel_Display[j]==3)
 842   4            {
 843   5              Para[0]=(float)(DataThouth[m+1]*1000+DataCent[m+1]*100+DataTenth[m+1]*10+DataGe[m+1]);//µ÷½Ú²ÎÊý
 844   5              Para[1]=(float)((float)(DataThouth[m+2]*1000+DataCent[m+2]*100+DataTenth[m+2]*10+DataGe[m+2])/10);
 845   5              DoseRata[j]=(float)(Para[1]*((uint)Real_Count_Display[j]-Para[0]));
 846   5            }
 847   4            else if(Channel_Display[j]==4)
 848   4            {
 849   5              Para[2]=(float)(DataThouth[m+3]*1000+DataCent[m+3]*100+DataTenth[m+3]*10+DataGe[m+3]);//µ÷½Ú²ÎÊý
 850   5              Para[3]=(float)((float)(DataThouth[m+4]*1000+DataCent[m+4]*100+DataTenth[m+4]*10+DataGe[m+4])*10);
 851   5              DoseRata[j]=(float)(Para[3]*((uint)Real_Count_Display[j]-Para[2]));
 852   5            }
 853   4          }
 854   3            /**********µ¥Î»»»ËãºóÎªjtemp************/
 855   3          if(DoseRata[j]==0)
 856   3          {
 857   4          Flag_dw=1;
 858   4          }
 859   3            if(DoseRata[j]<0)                                                         //ÐÞ¸Ä2012.6.15Í¨¹ý¾ùÖµ¼ÆË
             -ã
 860   3            {
 861   4              jtemp=0.0;
 862   4            }
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 17  

 863   3            else if(DoseRata[j]>=0)                                                   //Mean_ValueÆ½¾ùÖµµ¥Î»ÎªuG
             -y/h
 864   3            {
 865   4              if(DoseRata[j]<1000)                                                    //Mean_Value<1000±íÊ¾µ¥Î»Î
             -ªuGy/h
 866   4              {
 867   5                jtemp=(float)DoseRata[j];
 868   5                Flag_dw=1;
 869   5              }
 870   4              else if((DoseRata[j]>=1000)&&(DoseRata[j]<1000000))                   //1000<Mean_Value<1000000±íÊ
             -¾mGy/h
 871   4              {
 872   5                jtemp=(float)(DoseRata[j]/1000);
 873   5                Flag_dw=2;
 874   5              }
 875   4              else if(DoseRata[j]>=1000000)                                           //Mean_Value>=1000000±íÊ¾G
             -y/h
 876   4              {
 877   5                jtemp=(float)(DoseRata[j]/1000000);
 878   5                Flag_dw=3;
 879   5              }
 880   4            }
 881   3            /*****DCS·¢ËÍÊý¾Ý×¼±¸****/
 882   3            if(DoseRata[j]<0)                                                         //Èô¼ÆËã¼ÁÁ¿Ð¡ÓÚÁãÏòDCS·¢Ë
             -Í0
 883   3            {
 884   4              DCS_Send[j*4+4]=0x30;
 885   4              DCS_Send[j*4+5]=0x30;
 886   4              DCS_Send[j*4+6]=0x30;
 887   4              DCS_Send[j*4+7]=0x30;
 888   4            }
 889   3            else if(DoseRata[j]>=0)
 890   3            {
 891   4              if(DoseRata[j]<1)
 892   4              {
 893   5                temp=(float)DoseRata[j]*1000;
 894   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 895   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 896   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 897   5                DCS_Send[j*4+7]=0x30;
 898   5              }
 899   4              else if((DoseRata[j]>=1)&&(DoseRata[j]<10))
 900   4              {
 901   5                temp=(float)DoseRata[j]*100;
 902   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 903   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 904   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 905   5                DCS_Send[j*4+7]=0x31;
 906   5              }
 907   4              else if((DoseRata[j]>=10)&&(DoseRata[j]<100))
 908   4              {
 909   5                temp=(float)DoseRata[j]*10;
 910   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 911   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 912   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 913   5                DCS_Send[j*4+7]=0x32;
 914   5              }
 915   4              else if((DoseRata[j]>=100)&&(DoseRata[j]<1000))
 916   4              {
 917   5                temp=(float)DoseRata[j];
 918   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 919   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 18  

 920   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 921   5                DCS_Send[j*4+7]=0x33;
 922   5              }
 923   4              else if((DoseRata[j]>=1000)&&(DoseRata[j]<10000))
 924   4              {
 925   5                temp=(float)DoseRata[j]/10.0;
 926   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 927   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 928   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 929   5                DCS_Send[j*4+7]=0x34;
 930   5              }
 931   4              else if((DoseRata[j]>=10000)&&(DoseRata[j]<100000))
 932   4              {
 933   5                temp=(float)DoseRata[j]/100.0;
 934   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 935   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 936   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 937   5                DCS_Send[j*4+7]=0x35;
 938   5              }
 939   4              else if((DoseRata[j]>=100000)&&(DoseRata[j]<1000000))
 940   4              {
 941   5                temp=(float)DoseRata[j]/1000.0;
 942   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 943   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 944   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 945   5                DCS_Send[j*4+7]=0x36;
 946   5              }
 947   4              else if((DoseRata[j]>=1000000)&&(DoseRata[j]<10000000))
 948   4              {
 949   5                temp=(float)DoseRata[j]/10000.0;
 950   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 951   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 952   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 953   5                DCS_Send[j*4+7]=0x37;
 954   5              }
 955   4              else if((DoseRata[j]>=10000000)&&(DoseRata[j]<100000000))
 956   4              {
 957   5                temp=(float)DoseRata[j]/100000.0;
 958   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 959   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 960   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 961   5                DCS_Send[j*4+7]=0x38;
 962   5              }
 963   4              else if((DoseRata[j]>=100000000)&&(DoseRata[j]<1000000000))
 964   4              {
 965   5                temp=(float)DoseRata[j]/1000000.0;
 966   5                DCS_Send[j*4+4]=(uchar)((int)temp/100)+0x30;
 967   5                DCS_Send[j*4+5]=(uchar)((int)temp%100/10)+0x30;
 968   5                DCS_Send[j*4+6]=(uchar)((int)temp%100%10)+0x30;
 969   5                DCS_Send[j*4+7]=0x39;
 970   5              }
 971   4            }
 972   3            /***********¼ÁÁ¿ÂÊ×ª»»µ¥Î»ºó×ª»»³É¿ÉÒÔÏÔÊ¾µÄBCDÂë*************/
 973   3            if((Tbcd[5]<=9)&&(Tbcd[4]<=9)&&(Tbcd[3]<=9)&&(Tbcd[2]<=9)&&(Tbcd[1]<=9)&&(Tbcd[0]<=9))//4.21ËÆºõ¶àÓà
             -£¬¿É²»¿ÉÒÔÐÞ¸Äµô
 974   3            {
 975   4              Tbcd[5]=(uchar)(((int)jtemp)/100);                                         //°ÙÎ»
 976   4              Tbcd[4]=(uchar)(((int)jtemp)%100/10);                                      //Ê®Î»
 977   4              Tbcd[3]=(uchar)(((int)jtemp)%100%10);                                      //¸öÎ»
 978   4              count_temp=(jtemp-(int)jtemp)*1000;                                         //¼ÆËãÐ¡ÓÚ1µÄ²¿·Ö£¬°ÑÐ
             -¡Êý²¿·Ö±ä´ó£¬±£ÁôÈýÎ»Ð¡Êý
 979   4              Tbcd[2]=(uchar)(count_temp/100);                                           //Ð¡Ð¡ÊýÊ®·ÖÎ»
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 19  

 980   4              Tbcd[1]=(uchar)(count_temp%100/10);                                        //Ð¡Êý°Ù·ÖÎ»
 981   4              Tbcd[0]=(uchar)(count_temp%100%10);                                        //Ð¡ÊýÇ§·ÖÎ»
 982   4              if(Flag_dw==1)                                                              //¸ù¾ÝTbcd[]¼ÆËãyudeci
             -de(float)ÓÃÀ´ÅÐ¶Ï¼ÁÁ¿ÂÊÊÇ·ñ³¬¹ýãÐÖµ
 983   4                yudecide=(float)(Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001);
 984   4              if(Flag_dw==2)
 985   4                yudecide=(float)((Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001)*1000);
 986   4              if(Flag_dw==3)
 987   4                yudecide=(float)((Tbcd[5]*100+Tbcd[4]*10+Tbcd[3]+Tbcd[2]*0.1+Tbcd[1]*0.01+Tbcd[0]*0.001)*1000000
             -);
 988   4            }
 989   3            /***********ÅÐ¶ÏãÐÖµ*************/
 990   3            mtemp=(YuThouth[j]+YuCent[j]*0.1+YuTenth[j]*0.01);                          //ÔÝÊ±Ã»¸ù¾ÝÎ»ÊýÐÞ¸Ä2012
             -.6.15
 991   3            yu=(double)(pow(10,YuGe[j]));
 992   3            yudata=(double)(mtemp*yu);
 993   3            if(yudecide>=yudata)                                                        //Èç¹û¼ÆÊý³¬¹ýÄ³Ò»¸ö·¶Î§
             -£¬ÔòÉùÒô±¨¾¯
 994   3            {
 995   4              if((Judge_Speak==0)||(Speak_Alarm()==1))                                  //·äÃùÆ÷±¨¾¯£¬Speak_Alar
             -m·µ»Ø1·äÃùÆ÷¹¤×÷
 996   4              {
 997   5                Flag_Warn=1;                                                            //±¨¾¯±êÖ¾ÖÃÒ»
 998   5              }
 999   4              Flag_need_Flash[j]=1;                                                     //LEDÉÁË¸±êÖ¾ÖÃ1
1000   4              State_Flash[j]=1;
1001   4              Var_Led=Var_Led&Svar0[j];                                                 //LED±¨¾¯Ö¸Ê¾µÆ£¨char£©S
             -var0[8]={0xFE,0xFD,0xFB,0xF7,0xEF,0xDF,0xBF,0x7F}
1002   4            }
1003   3            else if(yudecide<yudata)
1004   3            {
1005   4              Flag_need_Flash[j]=0;
1006   4              State_Flash[j]=0;
1007   4              Var_Led=Var_Led|Svar1[j];
1008   4            }
1009   3            /*AI1*¼ÁÁ¿ÂÊÏÔÊ¾Ó¦µ±ÔÚÌ½²âÆ÷±êÖ¾¸Ä±äÖ®Ç°******¼ÁÁ¿ÂÊÏÔÊ¾**********/
1010   3          //if(Channel_Detector[j]==0)
1011   3          //{
1012   3            //  Txtext(10,13+(j*58),"Gh");                                                  //AH1ÏÔÊ¾Ì½Í·
1013   3          //}
1014   3          //else
1015   3          //{
1016   3          //Txtext(10,13+(j*58),"Dh");
1017   3          //}
1018   3          /*AI1*******¼ÁÁ¿ÂÊÏÔÊ¾**********/
1019   3          if(Flag_need_Flash[j]==0)
1020   3          {
1021   4            if((Channel_Display[j]==0)||(Channel_Display[j]==1))
1022   4          {
1023   5            Txtext(10,13+(j*58),"GM");                          //AH1ÏÔÊ¾Ì½Í·
1024   5          }
1025   4          else
1026   4          {
1027   5            Txtext(10,13+(j*58),"DL");
1028   5          }
1029   4              Tnumber(60,13+(j*58),j+1);                                                  //ÏÔÊ¾Ì½Í·ºÅ
1030   4              Txtext(90,13+(j*58),":");                                                   //ÏÔÊ¾Ã°ºÅ
1031   4            Tnumber(470,13+(j*58),Channel_Detector[j][1]);
1032   4            Tnumber(440,13+(j*58),Channel_Detector[j][0]);
1033   4            Tnumber(390,13+(j*58),Average_Times[j]);
1034   4              if(Tbcd[5]!=0)                                                              //Èô°ÙÎ»·ÇÁã£¬¸ù¾ÝÊýµÄ´
             -óÐ¡À´ÏÔÊ¾
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 20  

1035   4              {
1036   5                Tnumber(130,13+(j*58),Tbcd[5]);
1037   5                Tnumber(160,13+(j*58),Tbcd[4]);
1038   5                Tnumber(190,13+(j*58),Tbcd[3]);
1039   5                Txtext(220,13+(j*58),".");
1040   5                Tnumber(240,13+(j*58),Tbcd[2]);
1041   5                Tnumber(270,13+(j*58),Tbcd[1]);
1042   5                Tnumber(300,13+(j*58),Tbcd[0]);
1043   5                if(Tdata<10)                                                              //ÓÃÓÚÏÔÊ¾TdataËø´æµÄ¼Æ
             -ÊýÖµÏÔÊ¾
1044   5                Tnumber(576,13+(j*58),Tdata);                                             //²âÊÔÍê³ÉºóÈ¥µô2012.6.
             -24
1045   5                else if((Tdata>=10)&&(Tdata<100))
1046   5                Tnumber(556,13+(j*58),Tdata);
1047   5                else if((Tdata>=100)&&(Tdata<1000))
1048   5                Tnumber(536,13+(j*58),Tdata);
1049   5                else if((Tdata>=1000)&&(Tdata<10000))
1050   5                Tnumber(516,13+(j*58),Tdata);
1051   5                else if(Tdata>=10000)
1052   5                Tnumber(496,13+(j*58),Tdata);
1053   5              }
1054   4              else
1055   4              {
1056   5                if(Tbcd[4]!=0)                                                            //°ÙÎ»ÎªÁãÊ®Î»·ÇÁã
1057   5                {
1058   6                  Tnumber(160,13+(j*58),Tbcd[4]);
1059   6                  Tnumber(190,13+(j*58),Tbcd[3]);
1060   6                  Txtext(220,13+(j*58),".");
1061   6                  Tnumber(240,13+(j*58),Tbcd[2]);
1062   6                  Tnumber(270,13+(j*58),Tbcd[1]);
1063   6                  Tnumber(300,13+(j*58),Tbcd[0]);
1064   6                  if(Tdata<10)
1065   6                    Tnumber(576,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6.
             -24
1066   6                  else if((Tdata>=10)&&(Tdata<100))
1067   6                    Tnumber(556,13+(j*58),Tdata);
1068   6                  else if((Tdata>=100)&&(Tdata<1000))
1069   6                    Tnumber(536,13+(j*58),Tdata);
1070   6                  else if((Tdata>=1000)&&(Tdata<10000))
1071   6                    Tnumber(516,13+(j*58),Tdata);
1072   6                  else if(Tdata>=10000)
1073   6                    Tnumber(496,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6.
             -24
1074   6                }
1075   5                else                                                                      //°ÙÎ»Ê®Î»Î»¾ùÎªÁã£¬¸öÎ
             -»·ÇÁã
1076   5                {
1077   6                  Tnumber(190,13+(j*58),Tbcd[3]);
1078   6                  Txtext(220,13+(j*58),".");                                              //.Õ¼20¸öÏñËØ
1079   6                  Tnumber(240,13+(j*58),Tbcd[2]);                                         //Ò»¸öÊý×ÖÕ¼30¸öÏñËØ
1080   6                  Tnumber(270,13+(j*58),Tbcd[1]);
1081   6                  Tnumber(300,13+(j*58),Tbcd[0]);
1082   6                  if(Tdata<10)
1083   6                    Tnumber(576,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6.
             -24
1084   6                  else if((Tdata>=10)&&(Tdata<100))                                       //¿ÉÒÔ¿´¼ûÒ»¸öÊý×ÖÕ¼20Ï
             -ñËØ
1085   6                    Tnumber(556,13+(j*58),Tdata);
1086   6                  else if((Tdata>=100)&&(Tdata<1000))
1087   6                    Tnumber(536,13+(j*58),Tdata);
1088   6                  else if((Tdata>=1000)&&(Tdata<10000))
1089   6                    Tnumber(516,13+(j*58),Tdata);
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 21  

1090   6                  else if(Tdata>=10000)
1091   6                    Tnumber(496,13+(j*58),Tdata);
1092   6                }
1093   5            }
1094   4              /**********¼ÆÁ¿µ¥Î»ÏÔÊ¾***********/
1095   4              if(Flag_dw==1)                                                              //²âÊÔÍê³Éºó¼ÓÉÏ2012.6.
             -24
1096   4              {
1097   5                Txtext(340,13+(j*58),"u");
1098   5              }
1099   4              else if(Flag_dw==2)
1100   4              {
1101   5                Txtext(340,13+(j*58),"m");
1102   5              }
1103   4              else if(Flag_dw==3)
1104   4              {
1105   5                Txtext(340,13+(j*58),"G");
1106   5              }
1107   4              Alarm();                                                                    //±¨¾¯
1108   4            }
1109   3          if(Flag_need_Flash[j]==1)
1110   3          {
1111   4          if((Channel_Display[j]==0)||(Channel_Display[j]==1))
1112   4          {
1113   5            Trxtext(7,13+(j*58),"  ");
1114   5            Trxtext(10,13+(j*58),"GM                        ");                       //AH1ÏÔÊ¾Ì½Í·
1115   5          }
1116   4          else
1117   4          {
1118   5            Trxtext(7,13+(j*58),"  ");
1119   5            Trxtext(10,13+(j*58),"DL                        ");
1120   5          }
1121   4              Trnumber(60,13+(j*58),j+1);                                                  //ÏÔÊ¾Ì½Í·ºÅ
1122   4              Trxtext(90,13+(j*58),":");                                                   //ÏÔÊ¾Ã°ºÅ
1123   4            Trnumber(470,13+(j*58),Channel_Detector[j][1]);
1124   4            Trnumber(440,13+(j*58),Channel_Detector[j][0]);
1125   4            Trnumber(390,13+(j*58),Average_Times[j]);
1126   4              if(Tbcd[5]!=0)                                                              //Èô°ÙÎ»·ÇÁã£¬¸ù¾ÝÊýµÄ´
             -óÐ¡À´ÏÔÊ¾
1127   4              {
1128   5                Trnumber(130,13+(j*58),Tbcd[5]);
1129   5                Trnumber(160,13+(j*58),Tbcd[4]);
1130   5                Trnumber(190,13+(j*58),Tbcd[3]);
1131   5                Trxtext(220,13+(j*58),".");
1132   5                Trnumber(240,13+(j*58),Tbcd[2]);
1133   5                Trnumber(270,13+(j*58),Tbcd[1]);
1134   5                Trnumber(300,13+(j*58),Tbcd[0]);
1135   5                if(Tdata<10)                                                              //ÓÃÓÚÏÔÊ¾TdataËø´æµÄ¼Æ
             -ÊýÖµÏÔÊ¾
1136   5                Trnumber(576,13+(j*58),Tdata);                                             //²âÊÔÍê³ÉºóÈ¥µô2012.6
             -.24
1137   5                else if((Tdata>=10)&&(Tdata<100))
1138   5                Trnumber(556,13+(j*58),Tdata);
1139   5                else if((Tdata>=100)&&(Tdata<1000))
1140   5                Trnumber(536,13+(j*58),Tdata);
1141   5                else if((Tdata>=1000)&&(Tdata<10000))
1142   5                Trnumber(516,13+(j*58),Tdata);
1143   5                else if(Tdata>=10000)
1144   5                Trnumber(496,13+(j*58),Tdata);
1145   5              }
1146   4              else
1147   4              {
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 22  

1148   5                if(Tbcd[4]!=0)                                                            //°ÙÎ»ÎªÁãÊ®Î»·ÇÁã
1149   5                {
1150   6                  Trnumber(160,13+(j*58),Tbcd[4]);
1151   6                  Trnumber(190,13+(j*58),Tbcd[3]);
1152   6                  Trxtext(220,13+(j*58),".");
1153   6                  Trnumber(240,13+(j*58),Tbcd[2]);
1154   6                  Trnumber(270,13+(j*58),Tbcd[1]);
1155   6                  Trnumber(300,13+(j*58),Tbcd[0]);
1156   6                  if(Tdata<10)
1157   6                    Trnumber(576,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6
             -.24
1158   6                  else if((Tdata>=10)&&(Tdata<100))
1159   6                    Trnumber(556,13+(j*58),Tdata);
1160   6                  else if((Tdata>=100)&&(Tdata<1000))
1161   6                    Trnumber(536,13+(j*58),Tdata);
1162   6                  else if((Tdata>=1000)&&(Tdata<10000))
1163   6                    Trnumber(516,13+(j*58),Tdata);
1164   6                  else if(Tdata>=10000)
1165   6                    Trnumber(496,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6
             -.24
1166   6                }
1167   5                else                                                                      //°ÙÎ»Ê®Î»Î»¾ùÎªÁã£¬¸öÎ
             -»·ÇÁã
1168   5                {
1169   6                  Trnumber(190,13+(j*58),Tbcd[3]);
1170   6                  Trxtext(220,13+(j*58),".");                                              //.Õ¼20¸öÏñËØ
1171   6                  Trnumber(240,13+(j*58),Tbcd[2]);                                         //Ò»¸öÊý×ÖÕ¼30¸öÏñËØ
1172   6                  Trnumber(270,13+(j*58),Tbcd[1]);
1173   6                  Trnumber(300,13+(j*58),Tbcd[0]);
1174   6                  if(Tdata<10)
1175   6                    Trnumber(576,13+(j*58),Tdata);                                         //²âÊÔÍê³ÉºóÈ¥µô2012.6
             -.24
1176   6                  else if((Tdata>=10)&&(Tdata<100))                                       //¿ÉÒÔ¿´¼ûÒ»¸öÊý×ÖÕ¼20Ï
             -ñËØ
1177   6                    Trnumber(556,13+(j*58),Tdata);
1178   6                  else if((Tdata>=100)&&(Tdata<1000))
1179   6                    Trnumber(536,13+(j*58),Tdata);
1180   6                  else if((Tdata>=1000)&&(Tdata<10000))
1181   6                    Trnumber(516,13+(j*58),Tdata);
1182   6                  else if(Tdata>=10000)
1183   6                    Trnumber(496,13+(j*58),Tdata);
1184   6                }
1185   5            }
1186   4              /**********¼ÆÁ¿µ¥Î»ÏÔÊ¾***********/
1187   4              if(Flag_dw==1)                                                              //²âÊÔÍê³Éºó¼ÓÉÏ2012.6.
             -24
1188   4              {
1189   5                Trxtext(340,13+(j*58),"u");
1190   5              }
1191   4              else if(Flag_dw==2)
1192   4              {
1193   5                Trxtext(340,13+(j*58),"m");
1194   5              }
1195   4              else if(Flag_dw==3)
1196   4              {
1197   5                Trxtext(340,13+(j*58),"G");
1198   5              }
1199   4              Alarm();                                                                    //±¨¾¯
1200   4            }
1201   3            send_buf[8*j]=Tbcd[5];                                                      //ÏòNIM-B·¢ËÍÏÔÊ¾Êý¾Ý
1202   3            send_buf[8*j+1]=Tbcd[4];
1203   3            send_buf[8*j+2]=Tbcd[3];
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 23  

1204   3            send_buf[8*j+3]=Tbcd[2];
1205   3            send_buf[8*j+4]=Tbcd[1];
1206   3            send_buf[8*j+5]=Tbcd[0];
1207   3            send_buf[8*j+6]=Flag_dw;                                                    //·¢ËÍµ¥Î»±êÖ¾
1208   3            send_buf[8*j+7]=Flag_need_Flash[j];                                         //LEDÉÁË¸±êÖ¾
1209   3          }
1210   2          for(j=0;j<8;j++)                                                              //ÖÃDCSÊý¾ÝµÄ±¨¾¯ÐÅºÅ
1211   2          {
1212   3            if(Flag_need_Flash[j])
1213   3            {
1214   4              DCS_Send[64]=DCS_Send[64]|Svar1[j];
1215   4            }
1216   3            else
1217   3            {
1218   4              DCS_Send[64]=DCS_Send[64]&Svar0[j];
1219   4            }
1220   3          }                                                                             //8¸öÌ½Í·¾ùÏÔÊ¾Ö´ÐÐÍê
1221   2          Flag_Warn_Count=1;
1222   2          jishucount++;                                                                 //¼ÆÊý´ÎÊýÔö¼Ó£¨ËãÆ½¾ùÖµ
             -Ê±ÓÃ£©
1223   2          if(jishucount==255)                                                           //¼ÆÊý´ÎÊýÒòÎªÊÇcharÐÍ±ä
             -Á¿£¬×î¶àÖ§³Ö255¸ö£¬ËùÒÔÒªÖÃÁã
1224   2            jishucount=8;
1225   2          if(jishucount>4)
1226   2            Flag_Meant=1;                                                               //Ç°Îå´ÎµÄÈ¡Öµ²»Òª£¬µÚÎå
             -´Î²Å¿ªÊ¼Òª£¬ÖÃFlag_Meant=1£»·ñÔò¾ùÖÃ0
1227   2          else
1228   2            Flag_Meant=0;
1229   2          //shortdelay(5000);                                                             //ÑÓÊ±
1230   2          //for(i=0;i<33;i++)//ÏÔÊ¾ÍêÇå0
1231   2          //buf[i]=0;
1232   2        }                                                                               //²âÁ¿±êÖ¾
1233   1        else
1234   1        {
1235   2          jishuguan_data=0;                                                             //needthinkwhetherneed?4
             -.21,int¼ÆÊý¹ÜÊý¾Ý£¬
1236   2          dianlishi_data=0;                                                             //µçÀëÊÒÊý¾Ý
1237   2          jishuguan_rata=0;                                                             //¼ÆÊý¹Ü¼ÆÊýÂÊ
1238   2          jishuguan_jtemp=0;                                                            //¼ÆÊý¹Ü¼ÁÁ¿Öµ(µ¥Î»×ª»»º
             -ó)
1239   2          dianlishi_jtemp=0;                                                            //µçÀëÊÒ¼ÁÁ¿Öµ£¨µ¥Î»×ª»»
             -ºó£©
1240   2          Tbcd[11]=0;
1241   2          Tbcd[10]=0;
1242   2          Tbcd[9]=0;
1243   2          Tbcd[8]=0;
1244   2          Tbcd[7]=0;
1245   2          Tbcd[6]=0;
1246   2          Tbcd[5]=0;
1247   2          Tbcd[4]=0;
1248   2          Tbcd[3]=0;
1249   2          Tbcd[2]=0;
1250   2          Tbcd[1]=0;
1251   2          Tbcd[0]=0;
1252   2          j=10*biaoding_input-7;                                                        //biaodin_inputÎªÒª±ê¶¨µ
             -ÄÌ½Í·ÐòºÅ
1253   2          jishuguan_data=buf[4*biaoding_input-1]*256+buf[4*biaoding_input-2];       //Ïàµ±ÓÚTdata
1254   2          jishuguan_rata=jishuguan_data*12;                                             //¼ÆÊýÂÊ£¬Ö±½Ó³ËÒÔ12?
1255   2          dianlishi_data=buf[4*biaoding_input+1]*256+buf[4*biaoding_input];     //µçÀëÊÒTdata
1256   2          Para[0]=(float)(DataThouth[j]*1000+DataCent[j]*100+DataTenth[j]*10+DataGe[j]);//µ÷½Ú²ÎÊý
1257   2          Para[1]=(float)((float)(DataThouth[j+1]*1000+DataCent[j+1]*100+DataTenth[j+1]*10+DataGe[j+1])/1000000)
             -;
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 24  

1258   2          jishuguan_DoseRata=(float)(Para[1]*(jishuguan_rata-Para[0]));
1259   2          if(jishuguan_DoseRata<0)
1260   2            jishuguan_DoseRata=0.0;
1261   2          jishuguan_jtemp=(float)jishuguan_DoseRata;
1262   2          if((Tbcd[11]<=9)&&(Tbcd[10]<=9)&&(Tbcd[9]<=9)&&(Tbcd[8]<=9)&&(Tbcd[7]<=9)&&(Tbcd[6]<=9))//4.21ËÆºõ¶àÓà
             -£¬¿É²»¿ÉÒÔÐÞ¸Äµô
1263   2          {
1264   3            Tbcd[11]=(uchar)(((int)jishuguan_jtemp)/100);                               //Ç§Î»
1265   3            Tbcd[10]=(uchar)(((int)jishuguan_jtemp)%100/10);                            //°ÙÎ»
1266   3            Tbcd[9]=(uchar)(((int)jishuguan_jtemp)%100%10);                             //¸öÎ»
1267   3            jishuguan_count_temp=(jishuguan_jtemp-(int)jishuguan_jtemp)*1000;
1268   3            Tbcd[8]=(uchar)(jishuguan_count_temp/100);
1269   3            Tbcd[7]=(uchar)(jishuguan_count_temp%100/10);
1270   3            Tbcd[6]=(uchar)(jishuguan_count_temp%100%10);
1271   3          }
1272   2          Para[2]=(float)(DataThouth[j+2]*1000+DataCent[j+2]*100+DataTenth[j+2]*10+DataGe[j+2]);//µ÷½Ú²ÎÊý
1273   2          Para[3]=(float)((float)(DataThouth[j+3]*1000+DataCent[j+3]*100+DataTenth[j+3]*10+DataGe[j+3])/1000);
1274   2          dianlishi_DoseRata=(float)(Para[3]*(dianlishi_data-Para[2]));
1275   2          if(dianlishi_DoseRata<0)
1276   2            dianlishi_DoseRata=0.0;
1277   2          dianlishi_jtemp=(float)(dianlishi_DoseRata/1000);
1278   2          if((Tbcd[5]<=9)&&(Tbcd[4]<=9)&&(Tbcd[3]<=9)&&(Tbcd[2]<=9)&&(Tbcd[1]<=9)&&(Tbcd[0]<=9))//4.21ËÆºõ¶àÓà£¬
             -¿É²»¿ÉÒÔÐÞ¸Äµô
1279   2          {
1280   3            Tbcd[5]=(uchar)(((int)dianlishi_jtemp)/100);                                //Ç§Î»
1281   3            Tbcd[4]=(uchar)(((int)dianlishi_jtemp)%100/10);                             //°ÙÎ»
1282   3            Tbcd[3]=(uchar)(((int)dianlishi_jtemp)%100%10);                             //¸öÎ»
1283   3            dianlishi_count_temp=(dianlishi_jtemp-(int)dianlishi_jtemp)*1000;
1284   3            Tbcd[2]=(uchar)(dianlishi_count_temp/100);
1285   3            Tbcd[1]=(uchar)(dianlishi_count_temp%100/10);
1286   3            Tbcd[0]=(uchar)(dianlishi_count_temp%100%10);
1287   3          }
1288   2          Txtext(200,58,"±ê¶¨Ì½Í·");
1289   2          Tnumber(400,58,biaoding_input);
1290   2          Txtext(10,116,"¸Ç¸ï¹Ü");;
1291   2          Txtext(160,116,":");
1292   2          Txtext(220,174,"uGy/h");
1293   2          Txtext(520,174,"CPM");
1294   2          Txtext(10,290,"µçÀëÊÒ");;
1295   2          Txtext(160,290,":");
1296   2          Txtext(220,348,"mGy/h");
1297   2          Txtext(520,348,"CP5S");
1298   2          if(Tbcd[11]!=0)
1299   2          {
1300   3            Tnumber(10,174,Tbcd[11]);
1301   3            Tnumber(40,174,Tbcd[10]);
1302   3            Tnumber(70,174,Tbcd[9]);
1303   3            Txtext(100,174,".");
1304   3            Tnumber(130,174,Tbcd[8]);
1305   3            Tnumber(160,174,Tbcd[7]);
1306   3            Tnumber(190,174,Tbcd[6]);
1307   3            if(jishuguan_data<10)
1308   3              Tnumber(490,174,jishuguan_data);                                          //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1309   3            else if((jishuguan_data>=10)&&(jishuguan_data<100))
1310   3              Tnumber(460,174,jishuguan_data);
1311   3            else if((jishuguan_data>=100)&&(jishuguan_data<1000))
1312   3              Tnumber(430,174,jishuguan_data);
1313   3            else if((jishuguan_data>=1000)&&(jishuguan_data<10000))
1314   3              Tnumber(400,174,jishuguan_data);
1315   3            else if(jishuguan_data>=10000)
1316   3              Tnumber(370,174,jishuguan_data);
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 25  

1317   3          }
1318   2          else
1319   2          {
1320   3            if(Tbcd[10]!=0)
1321   3            {
1322   4              Tnumber(40,174,Tbcd[10]);
1323   4              Tnumber(70,174,Tbcd[9]);
1324   4              Txtext(100,174,".");
1325   4              Tnumber(130,174,Tbcd[8]);
1326   4              Tnumber(160,174,Tbcd[7]);
1327   4              Tnumber(190,174,Tbcd[6]);
1328   4              if(jishuguan_data<10)
1329   4              Tnumber(490,174,jishuguan_data);                                          //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1330   4              else if((jishuguan_data>=10)&&(jishuguan_data<100))
1331   4              Tnumber(460,174,jishuguan_data);
1332   4              else if((jishuguan_data>=100)&&(jishuguan_data<1000))
1333   4              Tnumber(430,174,jishuguan_data);
1334   4              else if((jishuguan_data>=1000)&&(jishuguan_data<10000))
1335   4              Tnumber(400,174,jishuguan_data);
1336   4              else if(jishuguan_data>=10000)
1337   4              Tnumber(370,174,jishuguan_data);
1338   4            }
1339   3            else
1340   3            {
1341   4              Tnumber(70,174,Tbcd[9]);
1342   4              Txtext(100,174,".");
1343   4              Tnumber(130,174,Tbcd[8]);
1344   4              Tnumber(160,174,Tbcd[7]);
1345   4              Tnumber(190,174,Tbcd[6]);
1346   4              if(jishuguan_data<10)
1347   4                Tnumber(490,174,jishuguan_data);                                        //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1348   4              else if((jishuguan_data>=10)&&(jishuguan_data<100))
1349   4                Tnumber(460,174,jishuguan_data);
1350   4              else if((jishuguan_data>=100)&&(jishuguan_data<1000))
1351   4                Tnumber(430,174,jishuguan_data);
1352   4              else if((jishuguan_data>=1000)&&(jishuguan_data<10000))
1353   4                Tnumber(400,174,jishuguan_data);
1354   4              else if(jishuguan_data>=10000)
1355   4                Tnumber(370,174,jishuguan_data);
1356   4            }
1357   3          }
1358   2          if(Tbcd[5]!=0)
1359   2          {
1360   3            Tnumber(10,348,Tbcd[5]);
1361   3            Tnumber(40,348,Tbcd[4]);
1362   3            Tnumber(70,348,Tbcd[3]);
1363   3            Txtext(100,348,".");
1364   3            Tnumber(130,348,Tbcd[2]);
1365   3            Tnumber(160,348,Tbcd[1]);
1366   3            Tnumber(190,348,Tbcd[0]);
1367   3            if(dianlishi_data<10)
1368   3              Tnumber(490,348,dianlishi_data);                                          //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1369   3            else if((dianlishi_data>=10)&&(dianlishi_data<100))
1370   3              Tnumber(460,348,dianlishi_data);
1371   3            else if((dianlishi_data>=100)&&(dianlishi_data<1000))
1372   3              Tnumber(430,348,dianlishi_data);
1373   3            else if((dianlishi_data>=1000)&&(dianlishi_data<10000))
1374   3              Tnumber(400,348,dianlishi_data);
1375   3            else if(dianlishi_data>=10000)
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 26  

1376   3              Tnumber(370,348,dianlishi_data);
1377   3          }
1378   2          else
1379   2          {
1380   3            if(Tbcd[4]!=0)
1381   3            {
1382   4              Tnumber(40,348,Tbcd[4]);
1383   4              Tnumber(70,348,Tbcd[3]);
1384   4              Txtext(100,348,".");
1385   4              Tnumber(130,348,Tbcd[2]);
1386   4              Tnumber(160,348,Tbcd[1]);
1387   4              Tnumber(190,348,Tbcd[0]);
1388   4              if(dianlishi_data<10)
1389   4                Tnumber(490,348,dianlishi_data);                                        //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1390   4              else if((dianlishi_data>=10)&&(dianlishi_data<100))
1391   4                Tnumber(460,348,dianlishi_data);
1392   4              else if((dianlishi_data>=100)&&(dianlishi_data<1000))
1393   4                Tnumber(430,348,dianlishi_data);
1394   4              else if((dianlishi_data>=1000)&&(dianlishi_data<10000))
1395   4                Tnumber(400,348,dianlishi_data);
1396   4              else if(dianlishi_data>=10000)
1397   4                Tnumber(370,348,dianlishi_data);
1398   4            }
1399   3            else
1400   3            {
1401   4              Tnumber(70,348,Tbcd[3]);
1402   4              Txtext(100,348,".");
1403   4              Tnumber(130,348,Tbcd[2]);
1404   4              Tnumber(160,348,Tbcd[1]);
1405   4              Tnumber(190,348,Tbcd[0]);
1406   4              if(dianlishi_data<10)
1407   4                Tnumber(490,348,dianlishi_data);                                        //²âÊÔÍê³ÉºóÈ¥µô2012.6.2
             -4
1408   4              else if((dianlishi_data>=10)&&(dianlishi_data<100))
1409   4                Tnumber(460,348,dianlishi_data);
1410   4              else if((dianlishi_data>=100)&&(dianlishi_data<1000))
1411   4                Tnumber(430,348,dianlishi_data);
1412   4              else if((dianlishi_data>=1000)&&(dianlishi_data<10000))
1413   4                Tnumber(400,348,dianlishi_data);
1414   4              else if(dianlishi_data>=10000)
1415   4                Tnumber(370,348,dianlishi_data);
1416   4            }
1417   3          }
1418   2        }
1419   1      }
1420          
1421          /************************************
1422          *¶ÌÑÓÊ±
1423          ************************************/
1424          void shortdelay(uint i)
1425          {
1426   1        uint k;
1427   1        uint n;
1428   1        for(k=0;k<i;k++)
1429   1          for(n=200;n>0;n--);
1430   1      }
1431          
1432          /********************************
1433          *Ö¸Ê¾µÆºÍ±¨¾¯
1434          ********************************/
1435          void Alarm()
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 27  

1436          {
1437   1        uchar n;
1438   1        for(n=0;n<10;n++)
1439   1        {
1440   2          Led573=Var_Led;
1441   2          if(Flag_Warn==1)                                                                  //ÉùÒô±¨¾¯
1442   2          {
1443   3            Speak=1;
1444   3          }
1445   2        }
1446   1      }
1447          
1448          /*******************************
1449          *¸üÐÂÖ¸Ê¾µÆ×´Ì¬
1450          *******************************/
1451          void Updata_Flash(uchar j)
1452          {
1453   1        if(Flag_need_Flash[j])
1454   1        {
1455   2          if(State_Flash[j]==1)
1456   2          {
1457   3            State_Flash[j]=0;
1458   3          }
1459   2          else
1460   2          {
1461   3            State_Flash[j]=1;
1462   3          }
1463   2        }
1464   1        else
1465   1        State_Flash[j]=0;
1466   1      }
1467          
1468          /***********************************
1469          *Ö¸Ê¾µÆÉÁË¸
1470          ************************************/
1471          void Led_Flash(void )
1472          {
1473   1        uchar i;
1474   1        for(i=0;i<8;i++)
1475   1        {
1476   2          Updata_Flash(i);                                                                  //×´Ì¬È¡·´
1477   2          Led_Disp(i,Flag_need_Flash[i],State_Flash[i]);                                    //µÆ×´Ì¬ÏÔÊ¾
1478   2        }
1479   1      }
1480          
1481          /************************************
1482          *Ö¸Ê¾µÆ×´Ì¬ÏÔÊ¾
1483          *************************************/
1484          void Led_Disp(uchar Num,uchar Flag,uchar State)
1485          {
1486   1        if(Flag)
1487   1        {
1488   2          if(State)
1489   2          {
1490   3            Var_Led=Var_Led&Svar0[Num];                                                       //Ö¸Ê¾µÆÁÁ
1491   3            Led573=Var_Led;
1492   3            if(Flag_Warn==1)                                                                  //ÐèÒª·äÃùÆ÷¹¤×÷
1493   3            {
1494   4              Speak=0;                                                                          //·äÃùÆ÷Ïì
1495   4              shortdelay(100);
1496   4            }
1497   3            return;
C51 COMPILER V9.60.7.0   8253COUNT                                                         01/26/2024 15:20:23 PAGE 28  

1498   3          }
1499   2        }
1500   1        Var_Led=Var_Led|Svar1[Num];                                                       //Ö¸Ê¾µÆÃð
1501   1        Led573=Var_Led;
1502   1        if(Flag_Warn==1)                                                                  //ÐèÒª·äÃùÆ÷¹¤×÷
1503   1        {
1504   2          Speak=1;                                                                          //·äÃùÆ÷²»Ïì
1505   2          shortdelay(100);
1506   2        }
1507   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  23522    ----
   CONSTANT SIZE    =    153    ----
   XDATA SIZE       =    611      41
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =     48      24
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
